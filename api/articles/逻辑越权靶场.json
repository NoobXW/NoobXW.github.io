{"title":"逻辑越权靶场","uid":"1851c5af9327b469d7ad45778d027d01","slug":"逻辑越权靶场","date":"2022-05-30T14:40:09.000Z","updated":"2022-05-30T16:02:11.360Z","comments":true,"path":"api/articles/逻辑越权靶场.json","keywords":null,"cover":[],"content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><script class=\"meting-secondary-script-marker\" src=\"\\assets\\js\\Meting.min.js\"></script><h2 id=\"0x00\"><a href=\"#0x00\" class=\"headerlink\" title=\"0x00\"></a>0x00</h2><p>靶机：pikachu逻辑越权，墨者靶场-身份认证失效漏洞实战</p>\n<p>攻击机：windows10</p>\n<h2 id=\"0x01-水平越权\"><a href=\"#0x01-水平越权\" class=\"headerlink\" title=\"0x01 水平越权\"></a>0x01 水平越权</h2><p>###0x00</p>\n<p>首先以普通用户登录：</p>\n<p><img src=\"/post/%E9%80%BB%E8%BE%91%E8%B6%8A%E6%9D%83%E9%9D%B6%E5%9C%BA.htm/image-20220530225044980.png\" alt=\"image-20220530225044980\"></p>\n<p><img src=\"/post/%E9%80%BB%E8%BE%91%E8%B6%8A%E6%9D%83%E9%9D%B6%E5%9C%BA.htm/image-20220530225055831.png\" alt=\"image-20220530225055831\"></p>\n<h3 id=\"0x01\"><a href=\"#0x01\" class=\"headerlink\" title=\"0x01\"></a>0x01</h3><p>抓包查看数据包信息：<br><img src=\"/post/%E9%80%BB%E8%BE%91%E8%B6%8A%E6%9D%83%E9%9D%B6%E5%9C%BA.htm/image-20220530225258398.png\" alt=\"image-20220530225258398\"></p>\n<p>将<code>username</code>字段中的kobe修改为lucy：</p>\n<p><img src=\"/post/%E9%80%BB%E8%BE%91%E8%B6%8A%E6%9D%83%E9%9D%B6%E5%9C%BA.htm/image-20220530225549405.png\" alt=\"image-20220530225549405\"></p>\n<p>可以看到用户切换成功，实现了水平越权。</p>\n<h2 id=\"0x02-垂直越权\"><a href=\"#0x02-垂直越权\" class=\"headerlink\" title=\"0x02 垂直越权\"></a>0x02 垂直越权</h2><p>所谓垂直越权就是低权限访问高权限进行一系列操作。</p>\n<p>###0x00</p>\n<p>同样，先登录，但这里首先需要以管理员身份登录，之后再使用普通用户登录：<br><img src=\"/post/%E9%80%BB%E8%BE%91%E8%B6%8A%E6%9D%83%E9%9D%B6%E5%9C%BA.htm/image-20220530230156393.png\" alt=\"image-20220530230156393\"></p>\n<p>###0x01</p>\n<p>这里admin用户可以进行增加修改删除用户的操作，这里随便创建一个用户并抓取数据包：<br><img src=\"/post/%E9%80%BB%E8%BE%91%E8%B6%8A%E6%9D%83%E9%9D%B6%E5%9C%BA.htm/image-20220530230546904.png\" alt=\"image-20220530230546904\"></p>\n<h3 id=\"0x02\"><a href=\"#0x02\" class=\"headerlink\" title=\"0x02\"></a>0x02</h3><p>切换pikachu用户，只有读权限，没有其他权限：<br><img src=\"/post/%E9%80%BB%E8%BE%91%E8%B6%8A%E6%9D%83%E9%9D%B6%E5%9C%BA.htm/image-20220530230803662.png\" alt=\"image-20220530230803662\"></p>\n<h3 id=\"0x03\"><a href=\"#0x03\" class=\"headerlink\" title=\"0x03\"></a>0x03</h3><p>将抓到的管理员创建用户的数据包修改为用户名为asdf，密码7989之后，将浏览器中的cookie替换repeater中的cookie（图中为替换之后的cookie），再将数据包发送出去。</p>\n<p><img src=\"/post/%E9%80%BB%E8%BE%91%E8%B6%8A%E6%9D%83%E9%9D%B6%E5%9C%BA.htm/image-20220530231639181.png\" alt=\"image-20220530231639181\"></p>\n<p><img src=\"/post/%E9%80%BB%E8%BE%91%E8%B6%8A%E6%9D%83%E9%9D%B6%E5%9C%BA.htm/image-20220530231651693.png\" alt=\"image-20220530231651693\"></p>\n<h3 id=\"0x04\"><a href=\"#0x04\" class=\"headerlink\" title=\"0x04\"></a>0x04</h3><p>刷新页面可以看到多了一个用户asdf，以低权限进行了高权限操作，实现了垂直越权。</p>\n<p><img src=\"/post/%E9%80%BB%E8%BE%91%E8%B6%8A%E6%9D%83%E9%9D%B6%E5%9C%BA.htm/image-20220530232026563.png\" alt=\"image-20220530232026563\"></p>\n<p><strong>这个操作的条件必须要获取管理员创建用户的数据包。</strong></p>\n<p>pikachu的垂直越权漏洞通过游客的cookie进行创建了新用户，这是由于源文件中的adminedit.php文件（用于管理员添加用户的文件）只验证了是否登录，没有验证级别，导致存在了越权问题，最终普通用户也可以进行创建用户。</p>\n<h2 id=\"墨者靶场—身份认证失效漏洞实战\"><a href=\"#墨者靶场—身份认证失效漏洞实战\" class=\"headerlink\" title=\"墨者靶场—身份认证失效漏洞实战\"></a>墨者靶场—身份认证失效漏洞实战</h2><h3 id=\"0x00-1\"><a href=\"#0x00-1\" class=\"headerlink\" title=\"0x00\"></a>0x00</h3><p>打开靶场，看到有个测试账户，而且题目也说了下级代理想要查看上级代理，必定要进行越权访问的。</p>\n<p><img src=\"/post/%E9%80%BB%E8%BE%91%E8%B6%8A%E6%9D%83%E9%9D%B6%E5%9C%BA.htm/image-20220530233940567.png\" alt=\"image-20220530233940567\"></p>\n<p><img src=\"/post/%E9%80%BB%E8%BE%91%E8%B6%8A%E6%9D%83%E9%9D%B6%E5%9C%BA.htm/image-20220530234141567.png\" alt=\"image-20220530234141567\"></p>\n<h3 id=\"0x01-1\"><a href=\"#0x01-1\" class=\"headerlink\" title=\"0x01\"></a>0x01</h3><p>抓包分析：</p>\n<p><img src=\"/post/%E9%80%BB%E8%BE%91%E8%B6%8A%E6%9D%83%E9%9D%B6%E5%9C%BA.htm/image-20220530234550028.png\" alt=\"image-20220530234550028\"></p>\n<p><img src=\"/post/%E9%80%BB%E8%BE%91%E8%B6%8A%E6%9D%83%E9%9D%B6%E5%9C%BA.htm/image-20220530234559923.png\" alt=\"image-20220530234559923\"></p>\n<p>这里存在两个数据包，需要把第一个登录之后抓到的包放出去得到第二个<code>card_id</code>字段的包，这里<code>card_id</code>字段其实就是每个人的编号，那找到相应的编号即可，使用爆破模块进行爆破。</p>\n<h3 id=\"0x02-1\"><a href=\"#0x02-1\" class=\"headerlink\" title=\"0x02\"></a>0x02</h3><p>爆破模块爆破：<br><img src=\"/post/%E9%80%BB%E8%BE%91%E8%B6%8A%E6%9D%83%E9%9D%B6%E5%9C%BA.htm/image-20220530235504224.png\" alt=\"image-20220530235504224\"></p>\n<p>长度不一样的表示由用户，但需要找到对应的用户，而登录页面看到有马春生图片，打开查看器查找相关信息，可以找到其编号：<br><img src=\"/post/%E9%80%BB%E8%BE%91%E8%B6%8A%E6%9D%83%E9%9D%B6%E5%9C%BA.htm/image-20220530235817580.png\" alt=\"image-20220530235817580\"></p>\n<h3 id=\"0x03-1\"><a href=\"#0x03-1\" class=\"headerlink\" title=\"0x03\"></a>0x03</h3><p>将登录的数据包<code>card_id</code>值修改为<code>20128880316</code>进行登录：<br><img src=\"/post/%E9%80%BB%E8%BE%91%E8%B6%8A%E6%9D%83%E9%9D%B6%E5%9C%BA.htm/image-20220530235944269.png\" alt=\"image-20220530235944269\"></p>\n<p>得到用户名和密码，密码值加密，看其特征应该是md5，直接解密：</p>\n<p><img src=\"/post/%E9%80%BB%E8%BE%91%E8%B6%8A%E6%9D%83%E9%9D%B6%E5%9C%BA.htm/image-20220531000104555.png\" alt=\"image-20220531000104555\"></p>\n<h3 id=\"0x04-1\"><a href=\"#0x04-1\" class=\"headerlink\" title=\"0x04\"></a>0x04</h3><p>输入账号密码进行登录：<br><img src=\"/post/%E9%80%BB%E8%BE%91%E8%B6%8A%E6%9D%83%E9%9D%B6%E5%9C%BA.htm/image-20220531000203716.png\" alt=\"image-20220531000203716\"></p>\n<p>得到key值。</p>\n","text":"0x00靶机：pikachu逻辑越权，墨者靶场-身份认证失效漏洞实战 攻击机：windows10 0x01 水平越权###0x00 首先以普通用户登录： 0x01抓包查看数据包信息： 将username字段中的kobe修改为lucy： 可以看到用户切换成功，实现了水平越权。 0x...","link":"","photos":[],"count_time":{"symbolsCount":920,"symbolsTime":"1 mins."},"categories":[{"name":"逻辑越权","slug":"逻辑越权","count":6,"path":"api/categories/逻辑越权.json"}],"tags":[{"name":"逻辑越权","slug":"逻辑越权","count":6,"path":"api/tags/逻辑越权.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#0x00\"><span class=\"toc-text\">0x00</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#0x01-%E6%B0%B4%E5%B9%B3%E8%B6%8A%E6%9D%83\"><span class=\"toc-text\">0x01 水平越权</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#0x01\"><span class=\"toc-text\">0x01</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#0x02-%E5%9E%82%E7%9B%B4%E8%B6%8A%E6%9D%83\"><span class=\"toc-text\">0x02 垂直越权</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#0x02\"><span class=\"toc-text\">0x02</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#0x03\"><span class=\"toc-text\">0x03</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#0x04\"><span class=\"toc-text\">0x04</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%A2%A8%E8%80%85%E9%9D%B6%E5%9C%BA%E2%80%94%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81%E5%A4%B1%E6%95%88%E6%BC%8F%E6%B4%9E%E5%AE%9E%E6%88%98\"><span class=\"toc-text\">墨者靶场—身份认证失效漏洞实战</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#0x00-1\"><span class=\"toc-text\">0x00</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#0x01-1\"><span class=\"toc-text\">0x01</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#0x02-1\"><span class=\"toc-text\">0x02</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#0x03-1\"><span class=\"toc-text\">0x03</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#0x04-1\"><span class=\"toc-text\">0x04</span></a></li></ol></li></ol>","author":{"name":"Aurora","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"逻辑越权--登录脆弱及支付篡改","uid":"6ff7edeb448384a80b03b049d4e9dda5","slug":"逻辑越权-登录脆弱及支付篡改","date":"2022-05-31T13:00:46.000Z","updated":"2022-05-31T13:43:44.515Z","comments":true,"path":"api/articles/逻辑越权-登录脆弱及支付篡改.json","keywords":null,"cover":null,"text":"0x00 登录应用功能点安全问题检测功能点，检测，危害，修复方案等 检测：存在登录功能点的地方 危害：不用账号密码直接登录 登陆点越权方法： 1.登录点暴力破解：如果数据包传输的账号密码没有加密或加密方式已知，可以尝试暴力破解2.HTTP&#x2F;HTTPS 传输：https会...","link":"","photos":[],"count_time":{"symbolsCount":441,"symbolsTime":"1 mins."},"categories":[{"name":"逻辑越权","slug":"逻辑越权","count":6,"path":"api/categories/逻辑越权.json"}],"tags":[{"name":"逻辑越权","slug":"逻辑越权","count":6,"path":"api/tags/逻辑越权.json"}],"author":{"name":"Aurora","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"逻辑越权--水平垂直越权","uid":"e12149c3e216e6cbcac496259253a06d","slug":"逻辑越权-水平垂直越权","date":"2022-05-30T08:55:04.000Z","updated":"2022-05-30T10:40:06.234Z","comments":true,"path":"api/articles/逻辑越权-水平垂直越权.json","keywords":null,"cover":[],"text":"0x00脑图： 0x01 漏洞产生原因通常情况下，一个 Web 程序功能流程是登录 - 提交请求 - 验证权限 - 数据库查询 - 返回结果。如果验证权限不足，便会导致越权。常见的程序都会认为通过登录后即可验证用户的身份，从而不会做下一步验证，最后导致越权。 隐藏URL 直接对象...","link":"","photos":[],"count_time":{"symbolsCount":847,"symbolsTime":"1 mins."},"categories":[{"name":"逻辑越权","slug":"逻辑越权","count":6,"path":"api/categories/逻辑越权.json"}],"tags":[{"name":"逻辑越权","slug":"逻辑越权","count":6,"path":"api/tags/逻辑越权.json"}],"author":{"name":"Aurora","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}