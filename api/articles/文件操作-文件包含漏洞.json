{"title":"文件操作-文件包含漏洞","uid":"7b77b3ea2f4278aa34c51c9c5ad0efd9","slug":"文件操作-文件包含漏洞","date":"2022-03-20T09:52:07.000Z","updated":"2022-03-20T12:32:34.780Z","comments":true,"path":"api/articles/文件操作-文件包含漏洞.json","keywords":null,"cover":[],"content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><script class=\"meting-secondary-script-marker\" src=\"\\assets\\js\\Meting.min.js\"></script><h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>脑图：<br><img src=\"/post/%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C-%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E.htm/image-20220320180915280.png\" alt=\"image-20220320180915280\"></p>\n<h2 id=\"文件包含\"><a href=\"#文件包含\" class=\"headerlink\" title=\"文件包含\"></a>文件包含</h2><p>服务器执行PHP文件时，可以通过文件包含函数加载另一个文件中的PHP代码，并且当PHP来执行，这会为开发者节省大量的时间。这意味着可以创建供所有网页引用的标准页眉或菜单文件。当页面需要更新时，只更新一个包含文件就可以了，或者向网站添加一张新页面时，仅仅需要修改一下菜单文件（而不是更新所有网页中的链接）。</p>\n<h2 id=\"文件包含涉及函数\"><a href=\"#文件包含涉及函数\" class=\"headerlink\" title=\"文件包含涉及函数\"></a>文件包含涉及函数</h2><pre class=\"line-numbers language-none\"><code class=\"language-none\">require()函数：只要程序一运行就包含文件，找不到被包含的文件时会产生致命错误，并停止脚本\n\ninclude()函数：执行到include时才包含文件，找不到被包含文件时只会产生警告，脚本将继续执行\n\ninclude_once()函数：若文件中代码已被包含则不会再次包含\n\nrequire_once()函数：若文件中代码已被包含则不会再次包含<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n\n\n<h2 id=\"漏洞原理\"><a href=\"#漏洞原理\" class=\"headerlink\" title=\"漏洞原理\"></a>漏洞原理</h2><p>文件包含函数加载的参数没有经过过滤或者严格的定义，可以被用户控制，包含其他恶意文件，导致了执行了非预期的代码。</p>\n<p>例：</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n    <span class=\"token variable\">$filename</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'file'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">include</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$filename</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token delimiter important\">?></span></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>假如网站中有phpinfo.php文件，攻击者可以构造<code>?file=phpinfo.php</code>的payload进行读取敏感文件。</p>\n<h2 id=\"漏洞检测\"><a href=\"#漏洞检测\" class=\"headerlink\" title=\"漏洞检测\"></a>漏洞检测</h2><p>1、白盒：进行代码审计</p>\n<p>2、黑盒：漏扫工具，公开漏洞，手工看参数值及功能点</p>\n<h2 id=\"漏洞类型\"><a href=\"#漏洞类型\" class=\"headerlink\" title=\"漏洞类型\"></a>漏洞类型</h2><p>1、<strong>本地文件包含</strong>（读取本地的敏感文件）<br><code>file://C:\\Windows\\System32\\drivers\\etc\\hosts</code> 本地DNS存在<br><code>file://D:\\software\\phpStudy\\PHPTutorial\\php\\php-5.4.45\\php.ini php</code>的配置文件<br><code>file://D:\\software\\phpStudy\\PHPTutorial\\Apache\\conf\\httpd.conf http</code>的配置文件<br><code>file://D:\\software\\phpStudy\\PHPTutorial\\MySQL\\my.ini</code> 数据库的配置文件</p>\n<p><strong>当本地包含有限制的情况下常用绕过姿势：</strong><br>1、%00截断：</p>\n<p>条件：magic_quotes_gpc&#x3D;Off，php版本&lt;5.3.4</p>\n<p>filename&#x3D;..&#x2F;..&#x2F;..&#x2F;xxx.txt</p>\n<p>2、长度截断：</p>\n<p>条件：windows，点号<code>（.）</code>需要长于256；linux长于4096</p>\n<p>（相当于垃圾数据填充；由于命名过长会导致有限制的后缀名加不上来，导致绕过限制）</p>\n<p>2、<strong>远程文件包含</strong><br>一般情况下，远程文件包含的都是TXT文件，可以直接使用远程文件包含包含一句话木马，或者利用文件包含写入一句话木马(单引号)<br>必须开启<code>php.ini</code>中的<code>allow_url_include</code>才能使用远程包含<code>http://IP地址/文件名</code></p>\n<p><strong>远程包含有限制基本绕过姿势：</strong></p>\n<p>1、加%20</p>\n<p>2、加%23</p>\n<p>3、？</p>\n<p>4、……</p>\n<h2 id=\"伪协议\"><a href=\"#伪协议\" class=\"headerlink\" title=\"伪协议\"></a>伪协议</h2><p><img src=\"/post/%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C-%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E.htm/image-20220320183939141.png\" alt=\"image-20220320183939141\"></p>\n<p>参考文章：<br><a href=\"https://blog.csdn.net/DARKNOTES/article/details/118660183\">https://blog.csdn.net/DARKNOTES/article/details/118660183</a></p>\n<p><a href=\"https://www.cnblogs.com/endust/p/11804767.html\">https://www.cnblogs.com/endust/p/11804767.html</a></p>\n","text":"前言脑图： 文件包含服务器执行PHP文件时，可以通过文件包含函数加载另一个文件中的PHP代码，并且当PHP来执行，这会为开发者节省大量的时间。这意味着可以创建供所有网页引用的标准页眉或菜单文件。当页面需要更新时，只更新一个包含文件就可以了，或者向网站添加一张新页面时，仅仅需要修改...","link":"","photos":[],"count_time":{"symbolsCount":"1.3k","symbolsTime":"1 mins."},"categories":[{"name":"文件包含","slug":"文件包含","count":1,"path":"api/categories/文件包含.json"}],"tags":[{"name":"文件包含","slug":"文件包含","count":2,"path":"api/tags/文件包含.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%89%8D%E8%A8%80\"><span class=\"toc-text\">前言</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB\"><span class=\"toc-text\">文件包含</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%B6%89%E5%8F%8A%E5%87%BD%E6%95%B0\"><span class=\"toc-text\">文件包含涉及函数</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86\"><span class=\"toc-text\">漏洞原理</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%BC%8F%E6%B4%9E%E6%A3%80%E6%B5%8B\"><span class=\"toc-text\">漏洞检测</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%BC%8F%E6%B4%9E%E7%B1%BB%E5%9E%8B\"><span class=\"toc-text\">漏洞类型</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%BC%AA%E5%8D%8F%E8%AE%AE\"><span class=\"toc-text\">伪协议</span></a></li></ol>","author":{"name":"Aurora","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"文件操作-文件下载及读取","uid":"6e204dcc81a1dda57afcdf13b8c27892","slug":"文件操作-文件下载及读取","date":"2022-03-20T12:38:50.000Z","updated":"2022-03-20T14:13:54.806Z","comments":true,"path":"api/articles/文件操作-文件下载及读取.json","keywords":null,"cover":[],"text":"前言脑图： 漏洞原理文件下载（一些网站由于业务需求，往往需要提供文件查看或文件下载功能，但若对用户查看或下载的文件不做限制，则恶意用户就能够查看或下载任意敏感文件，这就是文件查看与下载漏洞。） 任意文件下载漏洞，正常的利用手段是下载服务器文件，如脚本代码，服务器配置或者是系统配置...","link":"","photos":[],"count_time":{"symbolsCount":"4.4k","symbolsTime":"4 mins."},"categories":[{"name":"任意文件下载","slug":"任意文件下载","count":1,"path":"api/categories/任意文件下载.json"}],"tags":[{"name":"任意文件下载","slug":"任意文件下载","count":1,"path":"api/tags/任意文件下载.json"}],"author":{"name":"Aurora","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"BUU-Crypto-看我回旋踢","uid":"5e40bb5a83b8a3c2081bbb8071845ea4","slug":"BUU-Crypto-看我回旋踢","date":"2022-03-19T14:10:12.000Z","updated":"2022-03-20T11:48:42.767Z","comments":true,"path":"api/articles/BUU-Crypto-看我回旋踢.json","keywords":null,"cover":[],"text":"前言记一次BUU密码学的CTF题目：看我回旋踢。不是很擅长密码学这一个方向，简单记录一下，毕竟计算机最后都不分家嘛。 0x00 启动靶场启动靶场下载压缩包，解压得到一串字符串 0x01synt&#123;5pq1004q-86n5-46q8-o720-oro5on0417r1&#...","link":"","photos":[],"count_time":{"symbolsCount":603,"symbolsTime":"1 mins."},"categories":[{"name":"CTF","slug":"CTF","count":10,"path":"api/categories/CTF.json"}],"tags":[{"name":"CTF","slug":"CTF","count":19,"path":"api/tags/CTF.json"},{"name":"Crypto","slug":"Crypto","count":1,"path":"api/tags/Crypto.json"}],"author":{"name":"Aurora","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}